<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[SushiHangover]]></title>
  <link href="http://sushihangover.github.io/atom.xml" rel="self"/>
  <link href="http://sushihangover.github.io/"/>
  <updated>2014-03-05T00:09:32-08:00</updated>
  <id>http://sushihangover.github.io/</id>
  <author>
    <name><![CDATA[Robert N.]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Cortex-M0 vs. M3 : LLVM and LD]]></title>
    <link href="http://sushihangover.github.io/cortex-m0-vs-m3-llvm-and-ld"/>
    <updated>2014-03-05T06:30:13-08:00</updated>
    <id>http://sushihangover.github.io/cortex-m0-vs-m3-llvm-and-ld</id>
    <content type="html"><![CDATA[<p><a href="http://sushihangover.github.io/images/ARM_Cortex-M_instruction_set_large.png"><img class="left" src="http://sushihangover.github.io/images/ARM_Cortex-M_instruction_set_small.png" title="&#34;ARM Cortex-M instruction set&#34;" alt="&#34;ARM Cortex-M instruction set&#34;"></a> One of the issues that you run into using Clang/LLVM as your compiler for bare-metal ARM Cortex cores is you have to directly use arm-none-eabi-ld to do your linking.</p>

<p>Directly using <strong>ld</strong> can be a bit nerve wrecking at times as normally you are just let gcc use collect2 and have it internally execute ld to perform your linking.</p>

<p>One of the areas using it directly that can bit you, is not linking to the proper libgcc.a for the Cortex-M that you are targeting. Looking into your <em>arm-none-eabi/lib/gcc/arm-none-eabi/X.X.X</em> tool-chain directory and you will find multiple directories. One for each ARM architecture; armv6-m, armv7-ar, armv7-m, thumb, thumb2, etc&hellip;</p>

<p>Add a library include for <em>architecture</em> directory that matches the core that you compiled against and everything will be fine:</p>

<p>Cortex M3 example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>arm-none-eabi-ld -Map bin/main.axf.map -T src/cortex_M3.ld --library-path /Users/administrator/Code/llvm_superproject/install/arm-none-eabi/newlib-syscalls/arm-none-eabi/lib/thumb/thumb2 --library-path /Users/administrator/Code/llvm_superproject/install/arm-none-eabi/newlib-syscalls/arm-none-eabi/lib/thumb  --library-path /Users/administrator/Code/llvm_superproject/install/arm-none-eabi/newlib-syscalls/arm-none-eabi/lib  --library-path /Users/administrator/Code/llvm_superproject/install/arm-none-eabi/lib/gcc/arm-none-eabi/4.8.3/armv7-m -g   obj/printf_with_malloc.o obj/startup.o --start-group -lgcc -lc --end-group -o bin/main.axf</span></code></pre></td></tr></table></div></figure>


<p>Cortex M0+ example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>arm-none-eabi-ld -Map bin/main.axf.map -T src/cortex_M0.ld --library-path /Users/administrator/Code/llvm_superproject/install/arm-none-eabi/newlib-syscalls/arm-none-eabi/lib/thumb/thumb2 --library-path /Users/administrator/Code/llvm_superproject/install/arm-none-eabi/lib/gcc/arm-none-eabi/4.8.3/armv6-m  --gc-sections --print-gc-sections  obj/printf_with_malloc.o obj/startup.o --start-group -lgcc -lc --end-group -o bin/main.axf</span></code></pre></td></tr></table></div></figure>


<p><a href="http://en.wikipedia.org/wiki/ARM_Cortex-M#Instruction_sets">ARM Cortex-M instruction sets</a></p>

<table class="wikitable">
<tbody><tr>
<th>ARM<br>
Cortex-M</th>
<th>Thumb</th>
<th>Thumb-2</th>
<th>Hardware<br>
multiply</th>
<th>Hardware<br>
divide</th>
<th>Saturated<br>
math</th>
<th>DSP<br>
extensions</th>
<th>Floating-point</th>
<th>ARM<br>
architecture</th>
<th>Core<br>
architecture</th>
</tr>
<tr>
<td>
<center>Cortex-M0<sup id="cite_ref-M0-TRM_1-2" class="reference"><a href="#cite_note-M0-TRM-1"><span>[</span>1<span>]</span></a></sup></center>
</td>
<td style="background: cyan">
<center>Most</center>
</td>
<td style="background: cyan">
<center>Subset</center>
</td>
<td style="background: yellow">
<center>1 or 32 cycle</center>
</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td>
<center>ARMv6-M<sup id="cite_ref-ARMv6-M-Manual_6-8" class="reference"><a href="#cite_note-ARMv6-M-Manual-6"><span>[</span>6<span>]</span></a></sup></center>
</td>
<td><a href="http://sushihangover.github.io/wiki/Von_Neumann_architecture" title="Von Neumann architecture">Von Neumann</a></td>
</tr>
<tr>
<td>
<center>Cortex-M0+<sup id="cite_ref-M0.2B-TRM_2-2" class="reference"><a href="#cite_note-M0.2B-TRM-2"><span>[</span>2<span>]</span></a></sup></center>
</td>
<td style="background: cyan">
<center>Most</center>
</td>
<td style="background: cyan">
<center>Subset</center>
</td>
<td style="background: yellow">
<center>1 or 32 cycle</center>
</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td>
<center>ARMv6-M<sup id="cite_ref-ARMv6-M-Manual_6-9" class="reference"><a href="#cite_note-ARMv6-M-Manual-6"><span>[</span>6<span>]</span></a></sup></center>
</td>
<td><a href="http://sushihangover.github.io/wiki/Von_Neumann_architecture" title="Von Neumann architecture">Von Neumann</a></td>
</tr>
<tr>
<td>
<center>Cortex-M1<sup id="cite_ref-M1-TRM_3-2" class="reference"><a href="#cite_note-M1-TRM-3"><span>[</span>3<span>]</span></a></sup></center>
</td>
<td style="background: cyan">
<center>Most</center>
</td>
<td style="background: cyan">
<center>Subset</center>
</td>
<td style="background: yellow">
<center>3 or 33 cycle</center>
</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td>
<center>ARMv6-M<sup id="cite_ref-ARMv6-M-Manual_6-10" class="reference"><a href="#cite_note-ARMv6-M-Manual-6"><span>[</span>6<span>]</span></a></sup></center>
</td>
<td><a href="http://sushihangover.github.io/wiki/Von_Neumann_architecture" title="Von Neumann architecture">Von Neumann</a></td>
</tr>
<tr>
<td>
<center>Cortex-M3<sup id="cite_ref-M3-TRM_4-2" class="reference"><a href="#cite_note-M3-TRM-4"><span>[</span>4<span>]</span></a></sup></center>
</td>
<td style="background: #90ff90; color: black; vertical-align: middle; text-align: center;" class="table-yes">Entire</td>
<td style="background: #90ff90; color: black; vertical-align: middle; text-align: center;" class="table-yes">Entire</td>
<td style="background: #90ff90; color: black; vertical-align: middle; text-align: center;" class="table-yes">1 cycle</td>
<td style="background: #90ff90; color: black; vertical-align: middle; text-align: center;" class="table-yes">Yes</td>
<td style="background: #90ff90; color: black; vertical-align: middle; text-align: center;" class="table-yes">Yes</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td style="background:#ff9090; color:black; vertical-align: middle; text-align: center;" class="table-no">No</td>
<td>
<center>ARMv7-M<sup id="cite_ref-ARMv7-M-Manual_7-9" class="reference"><a href="#cite_note-ARMv7-M-Manual-7"><span>[</span>7<span>]</span></a></sup></center>
</td>
<td><a href="http://sushihangover.github.io/wiki/Harvard_architecture" title="Harvard architecture">Harvard</a></td>
</tr>
<tr>
<td>
<center>Cortex-M4<sup id="cite_ref-M4-TRM_5-2" class="reference"><a href="#cite_note-M4-TRM-5"><span>[</span>5<span>]</span></a></sup></center>
</td>
<td style="background: #90ff90; color: black; vertical-align: middle; text-align: center;" class="table-yes">Entire</td>
<td style="background: #90ff90; color: black; vertical-align: middle; text-align: center;" class="table-yes">Entire</td>
<td style="background: #90ff90; color: black; vertical-align: middle; text-align: center;" class="table-yes">1 cycle</td>
<td style="background: #90ff90; color: black; vertical-align: middle; text-align: center;" class="table-yes">Yes</td>
<td style="background: #90ff90; color: black; vertical-align: middle; text-align: center;" class="table-yes">Yes</td>
<td style="background: #90ff90; color: black; vertical-align: middle; text-align: center;" class="table-yes">Yes</td>
<td style="background: yellow">
<center>Optional</center>
</td>
<td>
<center>ARMv7E-M<sup id="cite_ref-ARMv7-M-Manual_7-10" class="reference"><a href="#cite_note-ARMv7-M-Manual-7"><span>[</span>7<span>]</span></a></sup></center>
</td>
<td><a href="http://sushihangover.github.io/wiki/Harvard_architecture" title="Harvard architecture">Harvard</a></td>
</tr>
</tbody></table>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ARM Cortex-M3 Bare-metal With NEWLIB]]></title>
    <link href="http://sushihangover.github.io/arm-cortex-m3-bare-metal-with-newlib"/>
    <updated>2014-03-04T18:18:56-08:00</updated>
    <id>http://sushihangover.github.io/arm-cortex-m3-bare-metal-with-newlib</id>
    <content type="html"><![CDATA[<p>I am working on a custom NEWLIB but first I wanted to make sure that <a href="https://sourceware.org/newlib/">NEWLIB</a> compiled for ARM-NONE-EABI works out of the box with my ARM bare-metal <a href="http://llvm.org">Clang/LLVM</a> build and Qemu.</p>

<p>Lets start with a simple main() that includes printf, puts and malloc. The first test is related to malloc, as if your linker script is not setting up your heap properly and providing the heap &ldquo;end&rdquo; address as defined in NEWLIB then not much else is going to work (i.e. printf uses malloc). If malloc works, then lets so some printfs including one with a random string. After that lets keep increasing the size of our mallocs till we run out of heap space.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;      </span><span class="cm">/* printf, scanf, NULL */</span><span class="cp"></span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;     </span><span class="cm">/* malloc, free, rand */</span><span class="cp"></span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span> <span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">extern</span> <span class="kt">char</span> <span class="n">_heap_start</span><span class="p">;</span> <span class="cm">/* Defined by the linker from src/cortex_M3.ld */</span>
</span><span class='line'>  <span class="k">extern</span> <span class="kt">char</span> <span class="n">_heap_end</span><span class="p">;</span> <span class="cm">/* Defined by the linker from src/cortex_M3.Ld. */</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span> <span class="n">buffer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">i</span> <span class="o">=</span> <span class="mi">43</span><span class="p">;</span>
</span><span class='line'>  <span class="n">buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span><span class="o">==</span><span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>     <span class="n">puts</span> <span class="p">(</span><span class="s">&quot;Malloc failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>     <span class="n">exit</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Printf string</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">n</span><span class="o">&lt;</span><span class="n">i</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">26</span><span class="o">+</span><span class="sc">&#39;a&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Random string: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">buffer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">i</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
</span><span class='line'>  <span class="k">do</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>     <span class="n">buffer</span> <span class="o">=</span> <span class="n">realloc</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'>     <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Out of memory!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">exit</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d bytes @ address 0x%X (Low=0x%X:Hi=0x%X)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span class='line'>           <span class="n">i</span><span class="p">,</span>
</span><span class='line'>           <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">buffer</span><span class="p">,</span>
</span><span class='line'>           <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="n">_heap_start</span><span class="p">,</span>
</span><span class='line'>           <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="n">_heap_end</span>
</span><span class='line'>       <span class="p">);</span>
</span><span class='line'>       <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">32</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">buffer</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="cm">/* cause qemu to exit */</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Easy enough, so lets create a linker script that is geared for a Cortex-M3, the main section to pay attention to in this example is <strong>.heap</strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>OUTPUT_FORMAT <span class="o">(</span><span class="s2">&quot;elf32-littlearm&quot;</span>, <span class="s2">&quot;elf32-bigarm&quot;</span>, <span class="s2">&quot;elf32-littlearm&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>ENTRY<span class="o">(</span>Reset_Handler<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>/* Specify the memory areas */
</span><span class='line'>MEMORY
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  FLASH <span class="o">(</span>rx<span class="o">)</span>      : <span class="nv">ORIGIN</span> <span class="o">=</span> 0x00000000, <span class="nv">LENGTH</span> <span class="o">=</span> 0x10000 /* 64K */
</span><span class='line'>  RAM <span class="o">(</span>xrw<span class="o">)</span>       : <span class="nv">ORIGIN</span> <span class="o">=</span> 0x00020000, <span class="nv">LENGTH</span> <span class="o">=</span> 0x04000 /* 16K */
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nv">heap_size</span> <span class="o">=</span> 0x800; /* 2K */
</span><span class='line'>
</span><span class='line'>SECTIONS <span class="o">{</span>
</span><span class='line'>    . <span class="o">=</span> ORIGIN<span class="o">(</span>FLASH<span class="o">)</span>;
</span><span class='line'>
</span><span class='line'>    .vectors :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span>;
</span><span class='line'>        KEEP<span class="o">(</span>*<span class="o">(</span>.vectors<span class="o">))</span> /* Startup code */
</span><span class='line'>        . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span>;
</span><span class='line'>    <span class="o">}</span> &gt;FLASH
</span><span class='line'>
</span><span class='line'>    .text :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span>;
</span><span class='line'>        <span class="nv">_start_text</span> <span class="o">=</span> .;
</span><span class='line'>        *<span class="o">(</span>.text<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>.text*<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>.rodata<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>.rodata*<span class="o">)</span>
</span><span class='line'>        <span class="nv">_end_text</span> <span class="o">=</span> .;
</span><span class='line'>    <span class="o">}</span> &gt;FLASH
</span><span class='line'>
</span><span class='line'>        .ARM.extab :
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>                *<span class="o">(</span>.ARM.extab* .gnu.linkonce.armextab.*<span class="o">)</span>
</span><span class='line'>        <span class="o">}</span> &gt; FLASH
</span><span class='line'>
</span><span class='line'>        <span class="nv">__exidx_start</span> <span class="o">=</span> .;
</span><span class='line'>        .ARM.exidx :
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>                *<span class="o">(</span>.ARM.exidx* .gnu.linkonce.armexidx.*<span class="o">)</span>
</span><span class='line'>        <span class="o">}</span> &gt; FLASH
</span><span class='line'>        <span class="nv">__exidx_end</span> <span class="o">=</span> .;
</span><span class='line'>
</span><span class='line'>    <span class="nv">_end_text</span> <span class="o">=</span> .;
</span><span class='line'>
</span><span class='line'>    .data : AT <span class="o">(</span>_end_text<span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="nv">_start_data</span> <span class="o">=</span> .;
</span><span class='line'>        *<span class="o">(</span>.data<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>.data*<span class="o">)</span>
</span><span class='line'>        . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span>;
</span><span class='line'>        <span class="nv">_end_data</span> <span class="o">=</span> .;
</span><span class='line'>    <span class="o">}</span> &gt;RAM
</span><span class='line'>
</span><span class='line'>    .bss :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>         . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span>;
</span><span class='line'>        <span class="nv">_start_bss</span> <span class="o">=</span> .;
</span><span class='line'>        *<span class="o">(</span>.bss<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>.bss*<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>COMMON<span class="o">)</span>
</span><span class='line'>        . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span>;
</span><span class='line'>        <span class="nv">_end_bss</span> <span class="o">=</span> .;
</span><span class='line'>    <span class="o">}</span> &gt;RAM
</span><span class='line'>
</span><span class='line'>    . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span>;
</span><span class='line'>    .heap :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="nv">__end__</span> <span class="o">=</span> .;
</span><span class='line'>        /* <span class="nv">_heap_start</span> <span class="o">=</span> .; */
</span><span class='line'>        /* <span class="s2">&quot;end&quot;</span> is used by newlib<span class="err">&#39;</span>s syscalls!!! */
</span><span class='line'>        PROVIDE<span class="o">(</span><span class="nv">end</span> <span class="o">=</span> .<span class="o">)</span>;
</span><span class='line'>        PROVIDE<span class="o">(</span><span class="nv">_heap_start</span> <span class="o">=</span> end <span class="o">)</span>;
</span><span class='line'>        . <span class="o">=</span> . + heap_size;
</span><span class='line'>        PROVIDE<span class="o">(</span><span class="nv">_heap_end</span> <span class="o">=</span> .<span class="o">)</span>;
</span><span class='line'>    <span class="o">}</span> &gt;RAM
</span><span class='line'>
</span><span class='line'>    .ARM.attributes 0 : <span class="o">{</span> *<span class="o">(</span>.ARM.attributes<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    .stack_dummy <span class="o">(</span>COPY<span class="o">)</span>:
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="nv">_end_stack</span> <span class="o">=</span> .;
</span><span class='line'>        *<span class="o">(</span>.stack*<span class="o">)</span>
</span><span class='line'>    <span class="o">}</span> &gt; RAM
</span><span class='line'>
</span><span class='line'>    /* Set stack top to end of RAM, and stack limit move down by
</span><span class='line'>     * size of stack_dummy section */
</span><span class='line'>    <span class="nv">_start_stack</span> <span class="o">=</span> ORIGIN<span class="o">(</span>RAM<span class="o">)</span> + LENGTH<span class="o">(</span>RAM<span class="o">)</span>;
</span><span class='line'>    <span class="nv">_size_stack</span> <span class="o">=</span> _start_stack - SIZEOF<span class="o">(</span>.stack_dummy<span class="o">)</span>;
</span><span class='line'>    PROVIDE<span class="o">(</span><span class="nv">__stack</span> <span class="o">=</span> _start_stack<span class="o">)</span>;
</span><span class='line'>
</span><span class='line'>    /* Check <span class="k">if </span>data + heap + stack exceeds RAM limit */
</span><span class='line'>    ASSERT<span class="o">(</span>_size_stack &gt;<span class="o">=</span> _heap_end, <span class="s2">&quot;region RAM overflowed with stack&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="nv">_end</span> <span class="o">=</span> .;
</span></code></pre></td></tr></table></div></figure>


<p>Ok, now that we have a linker script that defines our stack and heap properly, lets reuse our startup.c routine for the Cortex-M cores and compile it all with CLang/LLVM and link it with arm-none-eabi-ld:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>clang -g -nostdlib -ffreestanding  -O0  -target arm-none-eabi -mcpu<span class="o">=</span>cortex-m3  -mfloat-abi<span class="o">=</span>soft -mthumb -I/Users/administrator/Code/llvm_superproject/install/arm-none-eabi/newlib-syscalls/arm-none-eabi/include -I/Users/administrator/Code/llvm_superproject/install/arm-none-eabi/arm-none-eabi/include  -o obj/printf_with_malloc.o -c src/printf_with_malloc.c
</span><span class='line'>clang -g -nostdlib -ffreestanding  -O0  -target arm-none-eabi -mcpu<span class="o">=</span>cortex-m3  -mfloat-abi<span class="o">=</span>soft -mthumb -I/Users/administrator/Code/llvm_superproject/install/arm-none-eabi/newlib-syscalls/arm-none-eabi/include -I/Users/administrator/Code/llvm_superproject/install/arm-none-eabi/arm-none-eabi/include  -o obj/startup.o -c src/startup.c
</span><span class='line'>arm-none-eabi-ld -Map bin/main.axf.map -T src/cortex_M3.ld --library-path /Users/administrator/Code/llvm_superproject/install/arm-none-eabi/newlib-syscalls/arm-none-eabi/lib/thumb/thumb2 --library-path /Users/administrator/Code/llvm_superproject/install/arm-none-eabi/newlib-syscalls/arm-none-eabi/lib/thumb  --library-path /Users/administrator/Code/llvm_superproject/install/arm-none-eabi/newlib-syscalls/arm-none-eabi/lib  --library-path /Users/administrator/Code/llvm_superproject/install/arm-none-eabi/lib/gcc/arm-none-eabi/4.8.3/thumb -g   obj/printf_with_malloc.o obj/startup.o --start-group -lgcc -lc --end-group -o bin/main.axf
</span></code></pre></td></tr></table></div></figure>


<p>And now we can run a simulation of it with QEMU:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>qemu-system-arm -cpu cortex-m3  -semihosting -nographic -kernel  bin/main.axf
</span><span class='line'>Puts string
</span><span class='line'>Printf string
</span><span class='line'>Random string: lvqdyoqykfdbxnqdquhydjaeebzqmtblcabwgmscrno
</span><span class='line'>32 bytes @ address 0x209C0 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>64 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>96 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>128 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>160 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>192 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>224 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>256 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>288 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>320 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>352 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>384 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>416 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>448 bytes @ address 0x20DF8 <span class="o">(</span><span class="nv">Low</span><span class="o">=</span>0x209B4:Hi<span class="o">=</span>0x211B4<span class="o">)</span>
</span><span class='line'>Out of memory!
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bare Metal Debugging With Affinic Debugger]]></title>
    <link href="http://sushihangover.github.io/bare-metal-debugging-with-affinic-debugger"/>
    <updated>2014-02-26T23:19:58-08:00</updated>
    <id>http://sushihangover.github.io/bare-metal-debugging-with-affinic-debugger</id>
    <content type="html"><![CDATA[<p><a href="http://sushihangover.github.io/images/Affinic_gui_large.png"><img class="left" src="http://sushihangover.github.io/images/Affinic_gui_small.png" title="&#34;Affinic gdb on OS-X&#34;" alt="&#34;Affinic gdb on OS-X&#34;"></a> I am not currently using a full IDE for my bare metal C coding on OS-X. Thus is mainly due to my usage of an <a href="https://github.com/sushihangover/llvm_baremetal">ARM targeting Clang/LLVM build</a>) since I am compiling to LLVM <strong>bitcode</strong>, piping to <strong>opts</strong> and than handing the resulting object files directly to <strong>arm-none-eabi-ld</strong>. Makefile creation is the only way to get this build pipeline working as no IDE on any OS is natively supporting using LLVM as a cross-compiler for bare metal ARM (yet!).</p>

<p>Thus that leaves me in a term window a lot, not that I mind, but gdb (arm-none-eabi-gdb) based debugging can be a pain when you are used to working with a fully intergated IDE (<em>I dream of Visual Studio style bare metal debugging</em> ;&ndash;) . The &lsquo;layout asm&rsquo; and &lsquo;layout src&rsquo; text-based <em>gui</em>  of gdb does help a lot but till you learn all the commands and setup custom command-sets, productivity tends to suffer&hellip;</p>

<p>There are several GUI-based interfaces that can ease the pain of using gdb. <strong>Eclipse</strong> has the CDT debug perspective that provides a complete wrapper to <a href="http://www.ibm.com/developerworks/library/os-eclipse-cdt-debug2/index.html">gdb MI commands</a> and <strong>ddd</strong> (<a href="http://www.gnu.org/software/ddd/">Data Display Debugger</a>) provides a frontend to many session based cmd-line debuggers, including gdb. But I figured I would give <a href="http://www.affinic.com">Affinic Debugger</a> a quick try to see how it work.</p>

<p>Using Affinic Debugger for GDB does not completely shield you from gdb and you also have access to the gdb terminal so as you  learn gdb commands you can type them vs. clicking your way throught the GUI.</p>

<blockquote><p>You can use it as a gdb learning tool, as all the gui actions that involve gdb cmds are echo&rsquo;d in the intergated terminal.</p></blockquote>

<p><a href="http://sushihangover.github.io/images/Affinic_preferences_large.png"><img class="right" src="http://sushihangover.github.io/images/Affinic_preferences_small.png" title="&#34;Affinic gdb location&#34;" alt="&#34;Affinic gdb location&#34;"></a>After you download and install it, you will need to set which gdb you are using to debug your target. I am using a version of arm-none-eabi-gdb that I built, so start the app and open the Preferences and change the &ldquo;Set Debugger Path&rdquo; entry to the gdb that you are using. Affinic Debugger will need to restart after that change.</p>

<p>Lets debug something!</p>

<p>Using the HelloWorld example from last time, let re-compile it with Clang/LLVM using &ldquo;-g -O0&rdquo; so we get the debug symbols (-g) and remove any code optimizations (-O0) so the generated assembly is easy to follow and allow breakpoints to be set with the source code (depending upon optimization level, your breakpoints might be limited in the source view):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>clang -g -O0 -target arm-none-eabi -mcpu<span class="o">=</span>arm926ej-s -mfloat-abi<span class="o">=</span>soft -o obj/startup.o -c src/startup.s
</span><span class='line'>clang -g -O0 -target arm-none-eabi -mcpu<span class="o">=</span>arm926ej-s -mfloat-abi<span class="o">=</span>soft -o obj/HelloWorldSimple.o -c src/HelloWorldSimple.c
</span><span class='line'>arm-none-eabi-ld -Lobj --gc-sections --print-gc-sections  -T src/HelloWorldSimple.ld obj/startup.o obj/HelloWorldSimple.o -o bin/HelloWorldSimple.axf
</span><span class='line'>arm-none-eabi-size bin/HelloWorldSimple.axf
</span></code></pre></td></tr></table></div></figure>


<p>Lets startup QEMU as we will use it as our remote gdb debugging  target.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>qemu-system-arm -M versatilepb -m 128M -nographic -kernel  bin/HelloWorldSimple.axf -s -S
</span></code></pre></td></tr></table></div></figure>


<p>Note: We are using the two following additional options in order to remotely debug our HelloWorldSimple.axf program:</p>

<h6>* -s              shorthand for -gdb tcp::1234</h6>

<h6>* -S              freeze CPU at startup</h6>

<p>Now start Affinic and connect to the QEMU gdb remote debugging server that is running. Enter the following into the &ldquo;Command:&rdquo; text field:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>target remote localhost:1234
</span><span class='line'>file bin/HelloWorldSimple.axf</span></code></pre></td></tr></table></div></figure>


<p>Note: This is the same are if you were using gdb on the cmd-line. You can also use the Affinic menus to do this (Remote and File menus)</p>

<p><a href="http://sushihangover.github.io/images/Affinic_assembly_view_large.png"><img class="left" src="http://sushihangover.github.io/images/Affinic_assembly_view_small.png" title="&#34;Affinic gdb on OS-X&#34;" alt="&#34;Affinic gdb on OS-X&#34;"></a> You will see the assembly and source tabs filed. At this point you can set breakpoints, step through your source/assembly code, view register values, etc&hellip;
<a href="http://sushihangover.github.io/images/Affinic_source_view_large.png"><img class="right" src="http://sushihangover.github.io/images/Affinic_source_view_small.png" title="&#34;Affinic gdb on OS-X&#34;" alt="&#34;Affinic gdb on OS-X&#34;"></a></p>

<p>So far I like the Affinic Debugger interface, but I guess time will tell if I buy the full version after the 30 day trail, use the limited light/free version or setup ddd and/or Eclipse on my MacBookPro&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ARM Cortex-M Semihosting]]></title>
    <link href="http://sushihangover.github.io/arm-cortex-m-semihosting-with-qemu"/>
    <updated>2014-02-24T21:02:34-08:00</updated>
    <id>http://sushihangover.github.io/arm-cortex-m-semihosting-with-qemu</id>
    <content type="html"><![CDATA[<p><a href="http://sushihangover.github.io/images/ARM_Semihosting_large.png"><img class="left" src="http://sushihangover.github.io/images/ARM_Semihosting.png" title="&#34;ARM Semihosting&#34;" alt="&#34;ARM Semihosting&#34;"></a> <strong><a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0471c/Bgbjjgij.html">What is semihosting?</a></strong> <em>&hellip;Examples of these facilities include keyboard input, screen output, and disk I/O. For example, you can use this mechanism to enable functions in the C library, such as printf() and scanf(), to use the screen and keyboard of the host instead of having a screen and keyboard on the target system&hellip;</em></p>

<p>So you need to output some debug messages via your host debugging session (via JTAG or such) or working with QEMU to prototype some ARM code? Well semihosting is simple use, but it can come at a large price in memory and overhead if you use stdio to do it&hellip;</p>

<p>You can skip the &ldquo;#include &lt;stdio.h>&rdquo; and linking the semihosting newlib library (assuming you have the syscalls inplementated) and just use some simple inline assembly to get the job done.</p>

<p>Lets take a quick look at two of the twenty-some service calls (SVC) that are available, SYS_WRITEC (0x03) and WRITE0 (0x04).</p>

<h5>* SYS_WRITEC outputs a single character, an address pointer to that character is loaded in register R1. Register R0 is loaded with 0x03 and then you can execute a <em>SuperVisor Call</em> (SVC 0x00123456).</h5>

<h5>* SYS_WRITE0 outputs a null-term string, the string&rsquo;s beginning address is stored in R1, R0 is loaded with 0x04 and you execute a supervisor call again.</h5>

<p>If we translate that knowledge into inline assembly:</p>

<figure class='code'><figcaption><span>main.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">SYS_WRITEC</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">SYS_WRITE0</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
</span><span class='line'>  <span class="k">register</span> <span class="kt">int</span> <span class="n">reg0</span> <span class="k">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">register</span> <span class="kt">int</span> <span class="n">reg1</span> <span class="k">asm</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">outchar</span> <span class="o">=</span> <span class="sc">&#39;_&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// A &#39;NOP&#39; so we can &#39;see&#39; the start of the folllowing svc call</span>
</span><span class='line'>  <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mov r0,r0&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">outchar</span> <span class="o">=</span> <span class="sc">&#39;!&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">reg0</span> <span class="o">=</span> <span class="n">SYS_WRITEC</span><span class="p">;</span>
</span><span class='line'>  <span class="n">reg1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="n">outchar</span><span class="p">;</span>
</span><span class='line'>  <span class="k">asm</span><span class="p">(</span><span class="s">&quot;svc 0x00123456&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// A &#39;NOP&#39; so we can &#39;see&#39; the start of the folllowing svc call</span>
</span><span class='line'>  <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mov r0,r0&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">reg0</span> <span class="o">=</span> <span class="n">SYS_WRITEC</span><span class="p">;</span>
</span><span class='line'>  <span class="n">outchar</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">reg1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="n">outchar</span><span class="p">;</span>
</span><span class='line'>  <span class="k">asm</span><span class="p">(</span><span class="s">&quot;svc 0x00123456&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// A &#39;NOP&#39; so we can &#39;see&#39; the start of the folllowing svc call</span>
</span><span class='line'>  <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mov r0, r0&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">reg0</span> <span class="o">=</span> <span class="n">SYS_WRITE0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">reg1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="s">&quot;Print this to my jtag debugger</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">asm</span><span class="p">(</span><span class="s">&quot;svc 0x00123456&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h6>Note: This is not pretty inline styling as it is meant to break each step down. Normally you would create a couple of functions (i.e: a &lsquo;PutChar&rsquo; for SYS_WRITEC) and include the R0/R1 clobbers, etc&hellip;</h6>

<p>And the output that we get:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>qemu-system-arm -nographic -monitor null -serial null -semihosting -kernel main.axf 
</span><span class='line'>!
</span><span class='line'>Print this to my jtag debugger</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>main.o: file format elf32-littlearm </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='c-objdump'><span class='line'><span class="mh">00000000</span> <span class="p">&lt;</span><span class="nf">main</span><span class="p">&gt;:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="n">e52db004</span>     <span class="n">push</span> <span class="p">{</span><span class="n">fp</span><span class="p">}</span>       <span class="p">;</span> <span class="p">(</span><span class="n">str</span> <span class="n">fp</span><span class="p">,</span> <span class="p">[</span><span class="n">sp</span><span class="p">,</span> <span class="err">#</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>  <span class="n">e28db000</span>     <span class="n">add</span>  <span class="n">fp</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span>
</span><span class='line'>   <span class="mi">8</span><span class="o">:</span>  <span class="n">e24dd014</span>     <span class="n">sub</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="err">#</span><span class="mi">20</span>
</span><span class='line'>   <span class="nl">c:</span> <span class="n">e3a03003</span>     <span class="n">mov</span>  <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mi">3</span>
</span><span class='line'>  <span class="mi">10</span><span class="o">:</span>  <span class="n">e50b3008</span>     <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
</span><span class='line'>  <span class="mi">14</span><span class="o">:</span>  <span class="n">e3a03004</span>     <span class="n">mov</span>  <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span>
</span><span class='line'>  <span class="mi">18</span><span class="o">:</span>  <span class="n">e50b300c</span>     <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="o">-</span><span class="mi">12</span><span class="p">]</span>
</span><span class='line'>  <span class="mi">1</span><span class="n">c</span><span class="o">:</span>   <span class="n">e3a0305f</span>     <span class="n">mov</span>  <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mi">95</span>  <span class="p">;</span> <span class="mh">0x5f</span>
</span><span class='line'>  <span class="mi">20</span><span class="o">:</span>  <span class="n">e54b300d</span>     <span class="n">strb</span> <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="o">-</span><span class="mi">13</span><span class="p">]</span>
</span><span class='line'>  <span class="mi">24</span><span class="o">:</span>  <span class="n">e1a00000</span>     <span class="n">nop</span>          <span class="p">;</span> <span class="p">(</span><span class="n">mov</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">28</span><span class="o">:</span>  <span class="n">e3a03021</span>     <span class="n">mov</span>  <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mi">33</span>  <span class="p">;</span> <span class="mh">0x21</span>
</span><span class='line'>  <span class="mi">2</span><span class="n">c</span><span class="o">:</span>   <span class="n">e54b300d</span>     <span class="n">strb</span> <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="o">-</span><span class="mi">13</span><span class="p">]</span>
</span><span class='line'>  <span class="mi">30</span><span class="o">:</span>  <span class="n">e51b0008</span>     <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="p">[</span><span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
</span><span class='line'>  <span class="mi">34</span><span class="o">:</span>  <span class="n">e24b300d</span>     <span class="n">sub</span>  <span class="n">r3</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="mi">13</span>
</span><span class='line'>  <span class="mi">38</span><span class="o">:</span>  <span class="n">e1a01003</span>     <span class="n">mov</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r3</span>
</span><span class='line'>  <span class="mi">3</span><span class="n">c</span><span class="o">:</span>   <span class="n">ef123456</span>     <span class="n">svc</span>  <span class="mh">0x00123456</span>
</span><span class='line'>  <span class="mi">40</span><span class="o">:</span>  <span class="n">e1a00000</span>     <span class="n">nop</span>          <span class="p">;</span> <span class="p">(</span><span class="n">mov</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">44</span><span class="o">:</span>  <span class="n">e51b0008</span>     <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="p">[</span><span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
</span><span class='line'>  <span class="mi">48</span><span class="o">:</span>  <span class="n">e3a0300a</span>     <span class="n">mov</span>  <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mi">10</span>
</span><span class='line'>  <span class="mi">4</span><span class="n">c</span><span class="o">:</span>   <span class="n">e54b300d</span>     <span class="n">strb</span> <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="o">-</span><span class="mi">13</span><span class="p">]</span>
</span><span class='line'>  <span class="mi">50</span><span class="o">:</span>  <span class="n">e24b300d</span>     <span class="n">sub</span>  <span class="n">r3</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="mi">13</span>
</span><span class='line'>  <span class="mi">54</span><span class="o">:</span>  <span class="n">e1a01003</span>     <span class="n">mov</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r3</span>
</span><span class='line'>  <span class="mi">58</span><span class="o">:</span>  <span class="n">ef123456</span>     <span class="n">svc</span>  <span class="mh">0x00123456</span>
</span><span class='line'>  <span class="mi">5</span><span class="n">c</span><span class="o">:</span>   <span class="n">e1a00000</span>     <span class="n">nop</span>          <span class="p">;</span> <span class="p">(</span><span class="n">mov</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">60</span><span class="o">:</span>  <span class="n">e51b000c</span>     <span class="n">ldr</span>  <span class="n">r0</span><span class="p">,</span> <span class="p">[</span><span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="o">-</span><span class="mi">12</span><span class="p">]</span>
</span><span class='line'>  <span class="mi">64</span><span class="o">:</span>  <span class="n">e59f3010</span>     <span class="n">ldr</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">pc</span><span class="p">,</span> <span class="err">#</span><span class="mi">16</span><span class="p">]</span>    <span class="p">;</span> <span class="mi">7</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mh">0x7c</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="mi">68</span><span class="o">:</span>  <span class="n">e1a01003</span>     <span class="n">mov</span>  <span class="n">r1</span><span class="p">,</span> <span class="n">r3</span>
</span><span class='line'>  <span class="mi">6</span><span class="n">c</span><span class="o">:</span>   <span class="n">ef123456</span>     <span class="n">svc</span>  <span class="mh">0x00123456</span>
</span><span class='line'>  <span class="mi">70</span><span class="o">:</span>  <span class="n">e28bd000</span>     <span class="n">add</span>  <span class="n">sp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span>
</span><span class='line'>  <span class="mi">74</span><span class="o">:</span>  <span class="n">e8bd0800</span>     <span class="n">ldmfd</span>    <span class="n">sp</span><span class="o">!</span><span class="p">,</span> <span class="p">{</span><span class="n">fp</span><span class="p">}</span>
</span><span class='line'>  <span class="mi">78</span><span class="o">:</span>  <span class="n">e12fff1e</span>     <span class="n">bx</span>   <span class="n">lr</span>
</span><span class='line'>  <span class="mi">7</span><span class="n">c</span><span class="o">:</span>   <span class="mo">00000000</span>    <span class="p">.</span><span class="n">word</span> <span class="mh">0x00000000</span>
</span></code></pre></td></tr></table></div></figure>


<p>PS: SYS_TMPNAM and SYS_READC are not implemented in Qemu (up to and including 1.7.0), so consult the &ldquo;qemu/target-arm/arm-semi.c&rdquo; source if you are have questions about how those SVC calls are implemented.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LLVM and the ARM ELF .ARM.exidx* Section]]></title>
    <link href="http://sushihangover.github.io/llvm-and-the-arm-elf-arm-dot-exidx-star-section"/>
    <updated>2014-02-23T06:39:45-08:00</updated>
    <id>http://sushihangover.github.io/llvm-and-the-arm-elf-arm-dot-exidx-star-section</id>
    <content type="html"><![CDATA[<p>In my last <a href="http://sushihangover.github.io/arm-bare-metal-comparing-llvm-to-arm-gcc/">post</a> I did a very basic comparsion of ARM code generation between LLVM and GCC compilers and testing the AXF in Qemu. The stand out difference was LLVM produced a *.ARM.exidx** section in the AXF/ELF while arm-gcc did not. The code is very simple, one .s and one .c file, no .cpp/.h involved.</p>

<p>So what is a <em>.ARM.exidx</em> section?</p>

<p>ARM ELF manual show this under the special sections chapter:</p>

<table>
<thead>
<tr>
<th></th>
<th> Name </th>
<th>Type </th>
<th>Attributes </th>
<th> </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td> ARM.exidx </td>
<td> SHT_ARM_EXIDX </td>
<td> SHF_ALLOC + SHF_LINK_ORDER </td>
<td> </td>
</tr>
</tbody>
</table>


<p>_</p>

<blockquote><p>Names beginning .ARM.exidx name sections containing index entries for section unwinding. Names beginning .ARM.extab name sections containing exception unwinding information. See [EHABI] for details.</p></blockquote>

<p>Table 4_4 from that manual shows the Processor specific section types and our attribute is:</p>

<table>
<thead>
<tr>
<th></th>
<th> Name </th>
<th> Value </th>
<th> Comment </th>
<th> </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td> &ldquo;SHT_ARM_EXIDX&rdquo; </td>
<td> 0x70000001 </td>
<td> </td>
<td> </td>
</tr>
</tbody>
</table>


<p>_</p>

<p>So the question remains, what is in the section and what is being created? Lets dump HelloWorldSimple.o and only look at that section:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Relocation section '.rel.ARM.exidx' at offset 0x580 contains 2 entries:
</span><span class='line'> Offset     Info    Type            Sym.Value  Sym. Name
</span><span class='line'>00000000  00000b2a R_ARM_PREL31      00000000   .text
</span><span class='line'>00000008  00000b2a R_ARM_PREL31      00000000   .text
</span><span class='line'>Unwind table index '.ARM.exidx' at offset 0xcc contains 2 entries:
</span><span class='line'>0x0 &lt;print_uart0>: 0x1 [cantunwind]
</span><span class='line'>0x54 &lt;c_entry>: 0x1 [cantunwind]</span></code></pre></td></tr></table></div></figure>


<p>So it added both function calls to the table, but are marked <em>cantunwind</em>, which makes sense, but since nothing in the section can be unwound, why include the section? Using gc-sections during linking does not remove it as it has references to functions that are being used&hellip;</p>

<p><span class='pullquote-right' data-pullquote='Research is on-going on this one&#8230;'>
Let do a quick test and add <em>-funwind-tables</em>, recompile and yes we get a fully populated unwind table and using <em>-fno-unwind-tables</em> produces the results from above, so that is the default one that is being use. Research is on-going on this one&hellip;
</span></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Relocation section '.rel.ARM.exidx' at offset 0x5a4 contains 4 entries:
</span><span class='line'> Offset     Info    Type            Sym.Value  Sym. Name
</span><span class='line'>00000000  00000b2a R_ARM_PREL31      00000000   .text
</span><span class='line'>00000000  00001600 R_ARM_NONE        00000000   __aeabi_unwind_cpp_pr0
</span><span class='line'>00000008  00000b2a R_ARM_PREL31      00000000   .text
</span><span class='line'>00000008  00001600 R_ARM_NONE        00000000   __aeabi_unwind_cpp_pr0
</span><span class='line'>Unwind table index '.ARM.exidx' at offset 0xcc contains 2 entries:
</span><span class='line'>0x0 &lt;print_uart0>: 0x8001b0b0
</span><span class='line'>  Compact model index: 0
</span><span class='line'>  0x01      vsp = vsp + 8
</span><span class='line'>  0xb0      finish
</span><span class='line'>  0xb0      finish
</span><span class='line'>0x54 &lt;c_entry>: 0x809b8480
</span><span class='line'>  Compact model index: 0
</span><span class='line'>  0x9b      vsp = r11
</span><span class='line'>  0x84 0x80 pop {r11, r14}</span></code></pre></td></tr></table></div></figure>


<p>Additional Reading: <a href="https://sourceware.org/ml/binutils/2009-05/msg00048.html">ARM unwind table linker processing</a>; this concerns a patch to bintutils/ld:</p>

<blockquote><p>The patch below implements linker processing of ARM unwinding tables
(SHT_ARM_EXIDX).</p>

<p>ARM exception index tables only define the start address of each region. This
means that code with no unwinding information is effectively covered by the
preceding unwinding table entry.</p>

<p>For normal exceptions that doesn&rsquo;t matter so much &ndash; the user should ensure
that any code they throw exceptions through has proper unwinding information.</p></blockquote>

<p>Just as a quick check, I grep&rsquo;d some source and the *.ARM.exidx** section is generated by the ARMELFStreamer:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://llvm.org/docs/doxygen/html/ARMELFStreamer_8cpp_source.html
</span><span class='line'>00274 inline void ARMELFStreamer::SwitchToExIdxSection(const MCSymbol &FnStart) {
</span><span class='line'>00275   SwitchToEHSection(".ARM.exidx",
</span><span class='line'>00276                     ELF::SHT_ARM_EXIDX,
</span><span class='line'>00277                     ELF::SHF_ALLOC | ELF::SHF_LINK_ORDER,
</span><span class='line'>00278                     SectionKind::getDataRel(),
</span><span class='line'>00279                     FnStart);
</span><span class='line'>00280 }</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://llvm.org/docs/doxygen/html/Support_2ELF_8h_source.html01145   // Fixme: All this is duplicated in MCSectionELF. Why??
</span><span class='line'>01146   // Exception Index table
</span><span class='line'>01147   SHT_ARM_EXIDX           = 0x70000001U,</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ARM Bare Metal Hello World: Comparing LLVM & ARM-GCC]]></title>
    <link href="http://sushihangover.github.io/arm-bare-metal-comparing-llvm-to-arm-gcc"/>
    <updated>2014-02-22T20:43:28-08:00</updated>
    <id>http://sushihangover.github.io/arm-bare-metal-comparing-llvm-to-arm-gcc</id>
    <content type="html"><![CDATA[<p>With the ever maturing and stable ARM backend of LLVM it is hard to find information using it vs. the well known ARM-GCC release.</p>

<p>So lets start with the most simple HelloWorld example and compare LLVM and <a href="https://launchpad.net/gcc-arm-embedded">ARM-GCC</a>.</p>

<p><a href="http://balau82.wordpress.com/2010/02/28/hello-world-for-bare-metal-arm-using-qemu/">Balau&rsquo;s post</a> is a popular one showing an ARM bare metal Hello World and test using QEMU, so lets start with that one. First, lets reproduce the compile/link steps to make sure it works:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>arm-none-eabi-as -mcpu=arm926ej-s src/startup.s -o obj/startup.o
</span><span class='line'>arm-none-eabi-gcc -c -mcpu=arm926ej-s -O0 src/HelloWorldSimple.c -o obj/HelloWorldSimple.o
</span><span class='line'>arm-none-eabi-ld -T src/HelloWorldSimple.ld obj/HelloWorldSimple.o obj/startup.o -o bin/HelloWorldSimple.axf_gcc
</span><span class='line'>arm-none-eabi-size bin/HelloWorldSimple.axf_gcc
</span><span class='line'>qemu-system-arm -M versatilepb -m 128M -nographic -kernel bin/HelloWorldSimple.axf_gcc
</span><span class='line'>Hello world!
</span><span class='line'>QEMU: Terminated</span></code></pre></td></tr></table></div></figure>


<p>Works just fine, so lets reproduce that using   my <a href="https://github.com/sushihangover/llvm_baremetal">LLVM bare metal build</a>. All the compiler options are being shown even though some are defaulted in my build of LLVM so you can see everything it is required to get the LLVM bitcode conversion to produce a valid object file for our ARM target (I&rsquo;m using the Clang driver, but you can use LLVM and pipe bitcode through the various tools so you can deeply control the optimization phase):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>clang -c -target arm-none-eabi -mcpu=arm926ej-s -O0 -mfloat-abi=soft -g startup.s -o startup.o
</span><span class='line'>clang -c -target arm-none-eabi -mcpu=arm926ej-s -O0 -mfloat-abi=soft -g HelloWorldSimple.c -o main.o
</span><span class='line'>arm-none-eabi-ld -T HelloWorldSimple.ld main.o startup.o -o main.axf_llvm
</span><span class='line'>qemu-system-arm -M versatilepb -m 128M -nographic -kernel main.axf_llvm
</span><span class='line'>Hello world!
</span><span class='line'>QEMU: Terminated</span></code></pre></td></tr></table></div></figure>


<ul>
<li>target : Option providing the triple that you are &lsquo;targeting&rsquo;</li>
<li>mpcu : Option provding the ARM core that will be flashed</li>
<li>mfloat-abi : Soft or Hard depending upon if your ARM core has an FPU implementation on it. Cores that can support an FPU does not mean your vendor&rsquo;s core has one, comes down to features/price of the core.</li>
</ul>


<h6>Note: In both, I am turning off the optimizers via the compile drivers.</h6>

<p>Lets look at the size of the AXF (ARM Executable Format) produced by:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   text     data     bss     dec     hex filename
</span><span class='line'>    140         0       0     140      8c bin/HelloWorldSimple.axf_gcc
</span><span class='line'>    
</span><span class='line'>   text      data     bss     dec     hex filename
</span><span class='line'>    150         0       0     150      96 bin/HelloWorldSimple.axf</span></code></pre></td></tr></table></div></figure>


<p>There is a 10 byte difference, interesting&hellip; lets look at that a little more:</p>

<table>
<thead>
<tr>
<th></th>
<th> llvm </th>
<th></th>
<th></th>
<th> arm-gcc </th>
<th> </th>
<th> </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td> section  </td>
<td> size </td>
<td> addr</td>
<td>section </td>
<td>size</td>
<td> addr</td>
</tr>
<tr>
<td></td>
<td>.startup  </td>
<td>16</td>
<td>   65536</td>
<td>.startup </td>
<td> 16 </td>
<td>65536</td>
</tr>
<tr>
<td></td>
<td>.text </td>
<td>             108 </td>
<td>  65552</td>
<td>.text              </td>
<td>104   </td>
<td>65552</td>
</tr>
<tr>
<td></td>
<td>.ARM.exidx</td>
<td>           8 </td>
<td>  65660</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>.rodata   </td>
<td>           4 </td>
<td>  65668</td>
<td>.rodata  </td>
<td>           20  </td>
<td> 65656</td>
</tr>
<tr>
<td></td>
<td>.rodata.str1.1</td>
<td>      14 </td>
<td>  65672</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>.ARM.attributes</td>
<td>     40 </td>
<td>      0</td>
<td>.ARM.attributes </td>
<td>    46 </td>
<td>      0</td>
</tr>
<tr>
<td></td>
<td>.comment       </td>
<td>     19 </td>
<td>      0</td>
<td>.comment  </td>
<td>         112  </td>
<td>     0</td>
</tr>
<tr>
<td></td>
<td>Total          </td>
<td>    209</td>
<td></td>
<td>Total              </td>
<td>298</td>
<td></td>
</tr>
</tbody>
</table>


<h6>Note: I ran strip on the arm-gcc version to remove the empty debug sections that gcc inserts automatically</h6>

<p>The <strong>.startup</strong> are the same size since this code is assembly and no codegen or optimization will happen there.</p>

<p>It is interesting that LLVM inserts a <strong>.ARM.exidx</strong> section even though this is <em>only</em> .c code. I&rsquo;ll have to look at LLVM to see if <em>-funwind-tables</em> and/or <em>-fexceptions</em> are defaulted to on, but I disassemble it below so we can look at that as that is 8 bytes and accounts for the size difference in this really basic example.</p>

<blockquote><p>.ARM.exidx is the section containing information for unwinding the stack</p></blockquote>

<h6>Note: Understanding the <a href="http://infocenter.arm.com/help/topic/com.arm.doc.ihi0044e/IHI0044E_aaelf.pdf">ARM ELF format</a> is not really required to do bare metal programming, but, understanding how your code is allocated and loaded can maek a world of differences when you are writting linker definitions files for different cores, so send a few minutes and read the 46 pages :&ndash;)</h6>

<p>First the gcc disassembly so we can compare the LLVM version to it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bin/HelloWorldSimple.axf_gcc:     file format elf32-littlearm
</span><span class='line'>Disassembly of section .startup:
</span><span class='line'>00010000 &lt;_Reset&gt;:
</span><span class='line'>   10000: e59fd004    ldr sp, [pc, #4]    ; 1000c &lt;_Reset+0xc&gt;
</span><span class='line'>   10004: eb000015    bl  10060 &lt;c_entry&gt;
</span><span class='line'>   10008: eafffffe    b   10008 &lt;_Reset+0x8&gt;
</span><span class='line'>   1000c: 00011090    .word   0x00011090
</span><span class='line'>Disassembly of section .text:
</span><span class='line'>00010010 &lt;print_uart0&gt;:
</span><span class='line'>   10010: e52db004    push    {fp}        ; (str fp, [sp, #-4]!)
</span><span class='line'>   10014: e28db000    add fp, sp, #0
</span><span class='line'>   10018: e24dd00c    sub sp, sp, #12
</span><span class='line'>   1001c: e50b0008    str r0, [fp, #-8]
</span><span class='line'>   10020: ea000006    b   10040 &lt;print_uart0+0x30&gt;
</span><span class='line'>   10024: e59f3030    ldr r3, [pc, #48]   ; 1005c &lt;print_uart0+0x4c&gt;
</span><span class='line'>   10028: e51b2008    ldr r2, [fp, #-8]
</span><span class='line'>   1002c: e5d22000    ldrb    r2, [r2]
</span><span class='line'>   10030: e5832000    str r2, [r3]
</span><span class='line'>   10034: e51b3008    ldr r3, [fp, #-8]
</span><span class='line'>   10038: e2833001    add r3, r3, #1
</span><span class='line'>   1003c: e50b3008    str r3, [fp, #-8]
</span><span class='line'>   10040: e51b3008    ldr r3, [fp, #-8]
</span><span class='line'>   10044: e5d33000    ldrb    r3, [r3]
</span><span class='line'>   10048: e3530000    cmp r3, #0
</span><span class='line'>   1004c: 1afffff4    bne 10024 &lt;print_uart0+0x14&gt;
</span><span class='line'>   10050: e24bd000    sub sp, fp, #0
</span><span class='line'>   10054: e49db004    pop {fp}        ; (ldr fp, [sp], #4)
</span><span class='line'>   10058: e12fff1e    bx  lr
</span><span class='line'>   1005c: 101f1000    .word   0x101f1000
</span><span class='line'>00010060 &lt;c_entry&gt;:
</span><span class='line'>   10060: e92d4800    push    {fp, lr}
</span><span class='line'>   10064: e28db004    add fp, sp, #4
</span><span class='line'>   10068: e59f0004    ldr r0, [pc, #4]    ; 10074 &lt;c_entry+0x14&gt;
</span><span class='line'>   1006c: ebffffe7    bl  10010 &lt;print_uart0&gt;
</span><span class='line'>   10070: e8bd8800    pop {fp, pc}
</span><span class='line'>   10074: 0001007c    .word   0x0001007c</span></code></pre></td></tr></table></div></figure>


<p>Now the LLVM version:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bin/HelloWorldSimple.axf:     file format elf32-littlearm
</span><span class='line'>Disassembly of section .startup:
</span><span class='line'>00010000 &lt;_Reset&gt;:
</span><span class='line'>   10000: e59fd004    ldr sp, [pc, #4]    ; 1000c &lt;_Reset+0xc&gt;
</span><span class='line'>   10004: eb000016    bl  10064 &lt;c_entry&gt;
</span><span class='line'>   10008: eafffffe    b   10008 &lt;_Reset+0x8&gt;
</span><span class='line'>   1000c: 00011098    .word   0x00011098
</span><span class='line'>Disassembly of section .text:
</span><span class='line'>00010010 &lt;print_uart0&gt;:
</span><span class='line'>   10010: e24dd008    sub sp, sp, #8
</span><span class='line'>   10014: e1a01000    mov r1, r0
</span><span class='line'>   10018: e58d0004    str r0, [sp, #4]
</span><span class='line'>   1001c: e58d1000    str r1, [sp]
</span><span class='line'>   10020: e59d0004    ldr r0, [sp, #4]
</span><span class='line'>   10024: e5d00000    ldrb    r0, [r0]
</span><span class='line'>   10028: e3500000    cmp r0, #0
</span><span class='line'>   1002c: 0a000009    beq 10058 &lt;print_uart0+0x48&gt;
</span><span class='line'>   10030: eaffffff    b   10034 &lt;print_uart0+0x24&gt;
</span><span class='line'>   10034: e59d0004    ldr r0, [sp, #4]
</span><span class='line'>   10038: e5d00000    ldrb    r0, [r0]
</span><span class='line'>   1003c: e59f101c    ldr r1, [pc, #28]   ; 10060 &lt;print_uart0+0x50&gt;
</span><span class='line'>   10040: e5911000    ldr r1, [r1]
</span><span class='line'>   10044: e5810000    str r0, [r1]
</span><span class='line'>   10048: e59d0004    ldr r0, [sp, #4]
</span><span class='line'>   1004c: e2800001    add r0, r0, #1
</span><span class='line'>   10050: e58d0004    str r0, [sp, #4]
</span><span class='line'>   10054: eafffff1    b   10020 &lt;print_uart0+0x10&gt;
</span><span class='line'>   10058: e28dd008    add sp, sp, #8
</span><span class='line'>   1005c: e12fff1e    bx  lr
</span><span class='line'>   10060: 00010084    .word   0x00010084
</span><span class='line'>00010064 &lt;c_entry&gt;:
</span><span class='line'>   10064: e92d4800    push    {fp, lr}
</span><span class='line'>   10068: e1a0b00d    mov fp, sp
</span><span class='line'>   1006c: e59f0004    ldr r0, [pc, #4]    ; 10078 &lt;c_entry+0x14&gt;
</span><span class='line'>   10070: ebffffe6    bl  10010 &lt;print_uart0&gt;
</span><span class='line'>   10074: e8bd8800    pop {fp, pc}
</span><span class='line'>   10078: 00010088    .word   0x00010088</span></code></pre></td></tr></table></div></figure>


<p><a href="http://sushihangover.github.io/images/llvm-gcc-diff_large.png"><img class="left" src="http://sushihangover.github.io/images/llvm-gcc-diff_small.png" title="&#34;LLVM vs. GCC Hello World ARM Bare Metal&#34;" alt="&#34;LLVM vs. GCC Hello World ARM Bare Metal&#34;"></a> We can ignore the _Reset section as that is hand coded assembly and the same for both.</p>

<p>The c_entry is interesting as LLVM uses a move to copy the stack register to fp (r11 = frame pointer) which I what I would do, but arm-gcc does an &ldquo;&#8221;add&rdquo;&ldquo; to get fp into the sp and does that by adding fp to register #4(?) This is flagged as general variable for gcc&hellip; I am slightly confused by gcc&rsquo;s choice to do that, now that question is when would #4 not contain zero? The rest of this function is the same between the two compilers.</p>

<p>The print_uart0 function is a hack function as it does not implement FIFO/flow-control to an actual UART, but in this case it points to a memory address where the discontinued ARM Versatile PB dev-board does have a UART and QEMU board simulation echos those writes. I am not going to do a line by line comparision of the generated code as for un-optimized code they are both getting the job done, but in slightly different ways in almost the same number of instructions.</p>

<p>So we are able to produce a working bare metal ARM AXF from LLVM and next time, I will spend a little time on compiler optimizations to see how the two code generators/optimizisers compare&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OS-X : Using DiffMerge as Your Git Visual Merge and Diff Tool]]></title>
    <link href="http://sushihangover.github.io/using-diffmerge-as-your-git-visual-merge-and-diff-tool"/>
    <updated>2014-02-19T20:56:11-08:00</updated>
    <id>http://sushihangover.github.io/using-diffmerge-as-your-git-visual-merge-and-diff-tool</id>
    <content type="html"><![CDATA[<p><a href="http://sushihangover.github.io/images/diffmerge_large.png"><img class="right" src="http://sushihangover.github.io/images/diffmerge_small.png" title="&#34;LLVM vs. GCC code generation for Bare Metal ARM development&#34;" alt="&#34;LLVM vs. GCC code generation for Bare Metal ARM development&#34;"></a>
I tend to stay on the cmd line as much as possible, but for visual diffs, an ncurses console diff tool just does not cut it for me. <a href="http://www.scootersoftware.com/moreinfo.php">Beyond Compare Pro</a> by <a href="http://www.scootersoftware.com/index.php">Scooter</a> on Windows is one of best that I have ever used and with licenses at work I never had to worry about not having it on a work desktop or laptop.</p>

<p>But on OS-X at home, Beyond Compare was not available. There is a 4.0 release in the works (beta now), but $50.00 USD for a personal-use copy on OS-X and not having feature parity with Windows Pro features(?), I just can not pull the trigger on that purchuse when there are other
(cheaper) options that work just as well for personal development.</p>

<p>So, normally for a <strong>free</strong> visual diff, you can not beat <a href="http://meldmerge.org">meld</a>, it is a great open-source tool, but on OS-X it fires up X (Quartz for me) and it getting long in the tooth in terms of the GUI&rsquo;s human factors (feature set is still great). If there was a Qt version of this, the search would be over&hellip; free or not!</p>

<p>So some searching landed me on an old post by <a href="http://twobitlabs.com/2011/08/install-diffmerge-git-mac-os-x/">Todd Huss</a> about using DiffMerge as your visual diff/merge for git and it was actually what I was looking for, well almost ;&ndash;) It is missing a few features, but they have a free version and it works really well and has a great OS-X interface&hellip; search is over for now&hellip;</p>

<blockquote><p><a href="http://www.sourcegear.com/diffmerge/">SourceGear</a> has a $19.00 USD version that include file export with HTML formatting and if I could see example HTML code that it produces, I pay for that feature in a heart-beat, but the feature is completely locked out till you actaully register, bummer&hellip;</p></blockquote>

<p>Todd recommends using the DiffMerge installer version vs. the dmg version, I go the other way on that. Download the dmg version, open it and drag/drop the app to your Applications. Then in a term window you can copy the <em>Extras/diffmerge.sh</em> to your <em>/usr/local/bin</em> directory (Execute attrib is already set, so no chmod needed..), but I copied it as just <em>vdiff</em> as that is quicker to type. No admin rights are need to install it that way and that makes me happy&hellip; I can <em>vdiff file1.c file2.c</em> on the cmd line to pop the GUI open and populate it.</p>

<p>I then used the git setup he has listed and everything is working great so far. Click on the image above to it comparing the disassembly of <a href="http://sushihangover.github.io/images/diffmerge_large.png">LLVM vs. GCC code generation for bare metal ARM</a> development.</p>

<figure class='code'><figcaption><span>Your git setup is: </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git config --global diff.tool diffmerge
</span><span class='line'>git config --global difftool.diffmerge.cmd <span class="s1">&#39;diffmerge &quot;$LOCAL&quot; &quot;$REMOTE&quot;&#39;</span>
</span><span class='line'>git config --global merge.tool diffmerge
</span><span class='line'>git config --global mergetool.diffmerge.cmd <span class="s1">&#39;diffmerge --merge --result=&quot;$MERGED&quot; &quot;$LOCAL&quot; &quot;$(if test -f &quot;$BASE&quot;; then echo &quot;$BASE&quot;; else echo &quot;$LOCAL&quot;; fi)&quot; &quot;$REMOTE&quot;&#39;</span>
</span><span class='line'>git config --global mergetool.diffmerge.trustExitCode <span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Your git shortcuts are: linenos:false </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># diff the local file.m against the checked-in version</span>
</span><span class='line'>git difftool file.m
</span><span class='line'><span class="c"># diff the local file.m against the version in some-feature-branch</span>
</span><span class='line'>git difftool some-feature-branch file.m
</span><span class='line'><span class="c"># diff the file.m from the Build-54 tag to the Build-55 tag</span>
</span><span class='line'>git difftool Build-54..Build-55 file.m
</span><span class='line'><span class="c">#To resolve merge conflicts, just run git mergetool:</span>
</span><span class='line'>git mergetool
</span></code></pre></td></tr></table></div></figure>


<p>Thanks <a href="http://twobitlabs.com">Todd</a>, works great.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LLVM ARM Triple CPU Targets]]></title>
    <link href="http://sushihangover.github.io/llvm-arm-triple-cpu-targets"/>
    <updated>2014-02-19T06:36:42-08:00</updated>
    <id>http://sushihangover.github.io/llvm-arm-triple-cpu-targets</id>
    <content type="html"><![CDATA[<p>I am building a bare-metal ARM Clang/LLVM cross-compiler for my Arm Cortex-M LLVM vs. arm-gcc experiments and was looking for the complete ARM core list available.</p>

<p>LLVM makes it soooo easy to get that information from the LLVM static compiler binary (<a href="http://llvm.org/docs/CommandGuide/llc.html">llc</a>), just pass it a generic ARM triple, here is the lsit from my build:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>llc -mtriple=arm-none-eabi -mcpu=help</span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Available CPUs for this target:
</span><span class='line'>
</span><span class='line'>  arm1020e      - Select the arm1020e processor.
</span><span class='line'>  arm1020t      - Select the arm1020t processor.
</span><span class='line'>  arm1022e      - Select the arm1022e processor.
</span><span class='line'>  arm10e        - Select the arm10e processor.
</span><span class='line'>  arm10tdmi     - Select the arm10tdmi processor.
</span><span class='line'>  arm1136j-s    - Select the arm1136j-s processor.
</span><span class='line'>  arm1136jf-s   - Select the arm1136jf-s processor.
</span><span class='line'>  arm1156t2-s   - Select the arm1156t2-s processor.
</span><span class='line'>  arm1156t2f-s  - Select the arm1156t2f-s processor.
</span><span class='line'>  arm1176jz-s   - Select the arm1176jz-s processor.
</span><span class='line'>  arm1176jzf-s  - Select the arm1176jzf-s processor.
</span><span class='line'>  arm710t       - Select the arm710t processor.
</span><span class='line'>  arm720t       - Select the arm720t processor.
</span><span class='line'>  arm7tdmi      - Select the arm7tdmi processor.
</span><span class='line'>  arm7tdmi-s    - Select the arm7tdmi-s processor.
</span><span class='line'>  arm8          - Select the arm8 processor.
</span><span class='line'>  arm810        - Select the arm810 processor.
</span><span class='line'>  arm9          - Select the arm9 processor.
</span><span class='line'>  arm920        - Select the arm920 processor.
</span><span class='line'>  arm920t       - Select the arm920t processor.
</span><span class='line'>  arm922t       - Select the arm922t processor.
</span><span class='line'>  arm926ej-s    - Select the arm926ej-s processor.
</span><span class='line'>  arm940t       - Select the arm940t processor.
</span><span class='line'>  arm946e-s     - Select the arm946e-s processor.
</span><span class='line'>  arm966e-s     - Select the arm966e-s processor.
</span><span class='line'>  arm968e-s     - Select the arm968e-s processor.
</span><span class='line'>  arm9e         - Select the arm9e processor.
</span><span class='line'>  arm9tdmi      - Select the arm9tdmi processor.
</span><span class='line'>  cortex-a12    - Select the cortex-a12 processor.
</span><span class='line'>  cortex-a15    - Select the cortex-a15 processor.
</span><span class='line'>  cortex-a5     - Select the cortex-a5 processor.
</span><span class='line'>  cortex-a53    - Select the cortex-a53 processor.
</span><span class='line'>  cortex-a57    - Select the cortex-a57 processor.
</span><span class='line'>  cortex-a7     - Select the cortex-a7 processor.
</span><span class='line'>  cortex-a8     - Select the cortex-a8 processor.
</span><span class='line'>  cortex-a9     - Select the cortex-a9 processor.
</span><span class='line'>  cortex-a9-mp  - Select the cortex-a9-mp processor.
</span><span class='line'>  cortex-m0     - Select the cortex-m0 processor.
</span><span class='line'>  cortex-m3     - Select the cortex-m3 processor.
</span><span class='line'>  cortex-m4     - Select the cortex-m4 processor.
</span><span class='line'>  cortex-r5     - Select the cortex-r5 processor.
</span><span class='line'>  ep9312        - Select the ep9312 processor.
</span><span class='line'>  generic       - Select the generic processor.
</span><span class='line'>  iwmmxt        - Select the iwmmxt processor.
</span><span class='line'>  krait         - Select the krait processor.
</span><span class='line'>  mpcore        - Select the mpcore processor.
</span><span class='line'>  mpcorenovfp   - Select the mpcorenovfp processor.
</span><span class='line'>  strongarm     - Select the strongarm processor.
</span><span class='line'>  strongarm110  - Select the strongarm110 processor.
</span><span class='line'>  strongarm1100 - Select the strongarm1100 processor.
</span><span class='line'>  strongarm1110 - Select the strongarm1110 processor.
</span><span class='line'>  swift         - Select the swift processor.
</span><span class='line'>  xscale        - Select the xscale processor.</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[BUILDING LLDB on MAC OS X]]></title>
    <link href="http://sushihangover.github.io/building-lldb-on-mac-os-x"/>
    <updated>2014-02-18T08:21:07-08:00</updated>
    <id>http://sushihangover.github.io/building-lldb-on-mac-os-x</id>
    <content type="html"><![CDATA[<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/llvm/tools/lldb/tools/debugserver/source/MacOSX/dbgnub-mig.defs:13:10: fatal error: 'DNBConfig.h' file not found
</span><span class='line'>#include "DNBConfig.h"
</span><span class='line'>         ^
</span><span class='line'>1 error generated.</span></code></pre></td></tr></table></div></figure>


<p>I was trying to build LLDB &lsquo;out-of-source&rsquo; at the same time as LLVM, Polly, cloog, libcxx, etc&hellip; using ninja and got the error above. Missing source from a LLVM sub-project? I really doubted that and was right&hellip;</p>

<blockquote><p>DNBConfig.h is autogenerated by a perl script that is run as a build script in XCode. XCode is responsible for calling the script and setting the include paths correctly to locate it. The file will exist in the derived sources directory in the build folder.</p></blockquote>

<p>Well, the <a href="http://lldb.llvm.org/build.html">LLDB build instructions</a> are <em>clear</em> in that you need to build lldb from Xcode when on OS-X but I &lsquo;assumed&rsquo; that the <em>make</em> would call &ldquo;&#8221;xcodebuild -workspace lldb.xcworkspace -configuration Release -scheme LLVB clean build&rdquo; or some like that to build it&hellip; but I assumed wrong :&ndash;( &hellip; thus your ninja/make build will always fail&hellip;</p>

<p>I also can not find a disable option for LLDB when running llvm&rsquo;s &lsquo;configure&rsquo;, so if you have the lldb source in llvm/tools your configure will always include it and thus your build will always fail..?&hellip;</p>

<p>Why is this? Is this due to Apple preventing an <strong><em>un-codesigned</em></strong> version to be built/run on OS-X? Really confused by the whole thing. If someone knows, ping me&hellip; thanks&hellip;</p>

<p>Note: This is only on OS-X, building LLDB that has been included under llvm/tools under Linux/FreeBSD works as expected&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PowerShell and Bash 'Dot' Sourcing]]></title>
    <link href="http://sushihangover.github.io/powershell-and-bash-dot-sourcing"/>
    <updated>2014-02-17T06:21:11-08:00</updated>
    <id>http://sushihangover.github.io/powershell-and-bash-dot-sourcing</id>
    <content type="html"><![CDATA[<p>Parent/Child scoping of variables and functions can really mess with people starting out with PowerShell (or Bash).</p>

<p>In terms of &ldquo;Dot-sourcing&rdquo; a .ps1 file, it is like running the PowerShell script it contains <strong>inline</strong> in the current scope. Thus when that script finishes, any variables set/updated within it are changed within the current scope.</p>

<p>Let create a .ps1 file that increments the variable $x by one and &lsquo;outputs&rsquo; it to the pipe:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo "`$x++;`$x;" &gt; inc_x_by_one.ps1</span></code></pre></td></tr></table></div></figure>


<p>Now assign the variable $x to be 1</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$x=1
</span><span class='line'>$x
</span><span class='line'>1</span></code></pre></td></tr></table></div></figure>


<p>Now run the <em>inc_x_by_one.ps1</em> routine:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.\inc_x_by_one.ps1
</span><span class='line'>2</span></code></pre></td></tr></table></div></figure>


<p>So we got a result of 2 which is what you wanted right? Well, maybe&hellip; Let run the same thing again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.\inc_x_by_one.ps1
</span><span class='line'>2
</span><span class='line'>$x
</span><span class='line'>1</span></code></pre></td></tr></table></div></figure>


<p>What? Why is it not 3(?), and it is still 1!!! Well that is because the $x++ is executing in a <em>child scope</em>. Basically your script is getting a copy of $x, not a reference (pointer) to that variable. Same thing that you experience in passing variables to functions in C, C#, Java, etc&hellip;</p>

<p>If your desire is to actually change $x in your shell (the current scope), you can &lsquo;dot-source&rsquo; the call.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>. .\inc_x_by_one.ps1
</span><span class='line'>2
</span><span class='line'>. .\inc_x_by_one.ps1
</span><span class='line'>3
</span><span class='line'>$x
</span><span class='line'>3</span></code></pre></td></tr></table></div></figure>


<p>This is compariable to the way shell variables work under bash, zsh, &hellip; and I&rsquo;m assuming the PowerShell term borrowed &lsquo;dot sourcing&rsquo; in that regard as the syntax if the same: <strong>Period Space File.ps1|.sh</strong></p>

<p>Take a few minutes and read the help on <strong>scope</strong>, it just might save you a headache in the future ;&ndash;)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>help scope</span></code></pre></td></tr></table></div></figure>


<p>Note: In PowerShell, you can assign variables to the global scope and not &lsquo;worry&rsquo; about parent/child scoping rules. Normally this is not a preferred way  as it create it creates messy code, issues of which function/module is changing it, debugging nightmares, etc&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ARM Cortex-M0 Overview]]></title>
    <link href="http://sushihangover.github.io/arm-cortex-m0-overview"/>
    <updated>2014-02-17T06:02:25-08:00</updated>
    <id>http://sushihangover.github.io/arm-cortex-m0-overview</id>
    <content type="html"><![CDATA[<p>ARM Cortex-M0 Overview By: Daniel Widyanto September 2010</p>

<p  style=" margin: 12px auto 6px auto; font-family: Helvetica,Arial,Sans-serif; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; display: block;">   <a title="View ARM Cortex-M0 Overview on Scribd" href="http://www.scribd.com/doc/38226967"  style="text-decoration: underline;" >ARM Cortex-M0 Overview</a></p>


<iframe class="scribd_iframe_embed" src="http://sushihangover.github.io//www.scribd.com/embeds/38226967/content?start_page=1&view_mode=scroll&show_recommendations=true" data-auto-height="false" data-aspect-ratio="undefined" scrolling="no" id="doc_32615" width="100%" height="600" frameborder="0"></iframe>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bare Metal ARM Terminology]]></title>
    <link href="http://sushihangover.github.io/bare-metal-arm-terminology"/>
    <updated>2014-02-16T21:35:45-08:00</updated>
    <id>http://sushihangover.github.io/bare-metal-arm-terminology</id>
    <content type="html"><![CDATA[<p><a href="http://www.arm.com/products/processors/cortex-m/cortex-microcontroller-software-interface-standard.php">CMSIS</a> : ARM <strong>C</strong>ortex <strong>M</strong>icrocontroller <strong>S</strong>oftware <strong>I</strong>nterface <strong>S</strong>tandard</p>

<p>Thread mode :</p>

<blockquote><p>Used to execute application software. The processor enters Thread mode when it comes out of reset.</p></blockquote>

<p>Privileged or unprivileged software execution :</p>

<blockquote><p>Cortex-M0 do not support different privilege levels. Software execution is always privileged; i.e. Software can access all the features of the processor. Other ARM series do support pri and unpri execution.</p></blockquote>

<p>Handler mode :</p>

<blockquote><p>Used to handle exceptions. The processor returns to Thread mode when it has finished all exception processing</p></blockquote>

<p>SysTick : A 24-bit count-down timer.</p>

<blockquote><p>This timer is the basis for a <em>ticktimer</em> for an embedded Real Time Operating System (RTOS) like FreeRTOS. And, yes, it can be used as a simple counter.</p></blockquote>

<p>System Control Block :</p>

<blockquote><p>Provides system implementation information and system control, including configuration, control,and reporting of system exceptions.</p></blockquote>

<p>NVIC : Nested Vectored Interrupt Controller</p>

<blockquote><p>In the Cortex-M0, Cortex-M0+ and Cortex-M1 processors, the NVIC support up to 32 interrupts (IRQ), a Non-Maskable Interrupt (NMI) and various system exceptions, other M series, like M3/M4, can support up to 240 IRQs.
Tail chaining > If another exception is pending when an ISR exits, the processor does not restore all saved registers from the stack and instead moves on to the next ISR. This reduces the latency when switching from one exception handler to another.</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Homebrew: Git 1.9.0 Release]]></title>
    <link href="http://sushihangover.github.io/homebrew-git-1-dot-9-0-release"/>
    <updated>2014-02-16T10:32:41-08:00</updated>
    <id>http://sushihangover.github.io/homebrew-git-1-dot-9-0-release</id>
    <content type="html"><![CDATA[<blockquote><p>Update: Someone else has done a pull-request for homebrew git that is awaiting cool down on the new 1.9.0 release before it gets mainlined. As the formula is the basically the same as mine you can grab it via the <a href="https://github.com/Homebrew/homebrew/pull/26734">pull-request</a> on github and post 1.9.0 issues/comments in that thread.</p></blockquote>

<p><a href="https://code.google.com/p/git-core/">Git</a> just released <a href="https://code.google.com/p/git-core/downloads/detail?name=git-1.9.0.tar.gz">1.9.0</a> (Feb-14-2014) but <a href="http://brew.sh">Homebrew</a> does not have this update quite yet so I updated the tar ball references, sha1 tags and commented out the patch that is no longer required (this needs cleaned up as there are older patches commented out also&hellip;). As for the complete release notes, click <a href="http://anzwix.com/a/Git/Git190">here</a>.</p>

<p>I do not have time right now to do a pull-request, so here is a <a href="https://gist.github.com">gist</a> of it so you can update your Git version. Do a &ldquo;brew edit git&rdquo; and replace the contents with this and you can update to 1.9.0.</p>

<div><script src='https://gist.github.com/9036063.js?file=git.rb'></script>
<noscript><pre><code>require &#39;formula&#39;

class Git &lt; Formula
  homepage &#39;http://git-scm.com&#39;
  url &#39;https://git-core.googlecode.com/files/git-1.9.0.tar.gz&#39;
  sha1 &#39;e60667fc16e5a5f1cde46616b0458cc802707743&#39;
  head &#39;https://github.com/git/git.git&#39;

  bottle do
    sha1 &quot;582a276b608de17888da01922648522bf7a9c11a&quot; =&gt; :mavericks
    sha1 &quot;f308b293aa5664b65c57c3b206b892537397d3b9&quot; =&gt; :mountain_lion
    sha1 &quot;fa5f896b766bb103804800abde58e25579cf58a7&quot; =&gt; :lion
  end

  option &#39;with-blk-sha1&#39;, &#39;Compile with the block-optimized SHA1 implementation&#39;
  option &#39;without-completions&#39;, &#39;Disable bash/zsh completions from &quot;contrib&quot; directory&#39;
  option &#39;with-brewed-openssl&#39;, &quot;Build with Homebrew OpenSSL instead of the system version&quot;
  option &#39;with-brewed-curl&#39;, &quot;Use Homebrew&#39;s version of cURL library&quot;
  option &#39;with-persistent-https&#39;, &#39;Build git-remote-persistent-https from &quot;contrib&quot; directory&#39;

  depends_on &#39;pcre&#39; =&gt; :optional
  depends_on &#39;gettext&#39; =&gt; :optional
  depends_on &#39;openssl&#39; if build.with? &#39;brewed-openssl&#39;
  depends_on &#39;curl&#39; if build.with? &#39;brewed-curl&#39;
  depends_on &#39;go&#39; =&gt; :build if build.with? &#39;persistent-https&#39;

  resource &#39;man&#39; do
    url &#39;http://git-core.googlecode.com/files/git-manpages-1.9.0.tar.gz&#39;
    sha1 &#39;cff590c92b4d1c8a143c078473140b653cc5d56a&#39;
  end

  resource &#39;html&#39; do
    url &#39;http://git-core.googlecode.com/files/git-htmldocs-1.9.0.tar.gz&#39;
    sha1 &#39;65eb3f411f4699695c7081a7c716cabb9ce23d75&#39;
  end

  def patches
    if MacOS.version &gt;= :mavericks and not build.head?
      # Allow using PERLLIB_EXTRA to find Subversion Perl bindings location
      # in the CLT/Xcode. Should be included in Git 1.8.6.
      # https://git.kernel.org/cgit/git/git.git/commit/?h=next&amp;id=07981d
      # https://git.kernel.org/cgit/git/git.git/commit/?h=next&amp;id=0386dd
      #[&#39;https://git.kernel.org/cgit/git/git.git/patch/?id=07981d&#39;,
      # &#39;https://git.kernel.org/cgit/git/git.git/patch/?id=0386dd&#39;]
    end
  end

  def install
    # If these things are installed, tell Git build system to not use them
    ENV[&#39;NO_FINK&#39;] = &#39;1&#39;
    ENV[&#39;NO_DARWIN_PORTS&#39;] = &#39;1&#39;
    ENV[&#39;V&#39;] = &#39;1&#39; # build verbosely
    ENV[&#39;NO_R_TO_GCC_LINKER&#39;] = &#39;1&#39; # pass arguments to LD correctly
    ENV[&#39;PYTHON_PATH&#39;] = which &#39;python&#39;
    ENV[&#39;PERL_PATH&#39;] = which &#39;perl&#39;

    if MacOS.version &gt;= :mavericks and MacOS.dev_tools_prefix
      ENV[&#39;PERLLIB_EXTRA&#39;] = &quot;#{MacOS.dev_tools_prefix}/Library/Perl/5.16/darwin-thread-multi-2level&quot;
    end

    unless quiet_system ENV[&#39;PERL_PATH&#39;], &#39;-e&#39;, &#39;use ExtUtils::MakeMaker&#39;
      ENV[&#39;NO_PERL_MAKEMAKER&#39;] = &#39;1&#39;
    end

    ENV[&#39;BLK_SHA1&#39;] = &#39;1&#39; if build.with? &#39;blk-sha1&#39;

    if build.with? &#39;pcre&#39;
      ENV[&#39;USE_LIBPCRE&#39;] = &#39;1&#39;
      ENV[&#39;LIBPCREDIR&#39;] = Formula.factory(&#39;pcre&#39;).opt_prefix
    end

    ENV[&#39;NO_GETTEXT&#39;] = &#39;1&#39; unless build.with? &#39;gettext&#39;

    system &quot;make&quot;, &quot;prefix=#{prefix}&quot;,
                   &quot;sysconfdir=#{etc}&quot;,
                   &quot;CC=#{ENV.cc}&quot;,
                   &quot;CFLAGS=#{ENV.cflags}&quot;,
                   &quot;LDFLAGS=#{ENV.ldflags}&quot;,
                   &quot;install&quot;

    bin.install Dir[&quot;contrib/remote-helpers/git-remote-{hg,bzr}&quot;]

    # Install the OS X keychain credential helper
    cd &#39;contrib/credential/osxkeychain&#39; do
      system &quot;make&quot;, &quot;CC=#{ENV.cc}&quot;,
                     &quot;CFLAGS=#{ENV.cflags}&quot;,
                     &quot;LDFLAGS=#{ENV.ldflags}&quot;
      bin.install &#39;git-credential-osxkeychain&#39;
      system &quot;make&quot;, &quot;clean&quot;
    end

    # Install git-subtree
    cd &#39;contrib/subtree&#39; do
      system &quot;make&quot;, &quot;CC=#{ENV.cc}&quot;,
                     &quot;CFLAGS=#{ENV.cflags}&quot;,
                     &quot;LDFLAGS=#{ENV.ldflags}&quot;
      bin.install &#39;git-subtree&#39;
    end

    if build.with? &#39;persistent-https&#39;
      cd &#39;contrib/persistent-https&#39; do
        system &quot;make&quot;
        bin.install &#39;git-remote-persistent-http&#39;,
                    &#39;git-remote-persistent-https&#39;,
                    &#39;git-remote-persistent-https--proxy&#39;
      end
    end

    unless build.without? &#39;completions&#39;
      # install the completion script first because it is inside &#39;contrib&#39;
      bash_completion.install &#39;contrib/completion/git-completion.bash&#39;
      bash_completion.install &#39;contrib/completion/git-prompt.sh&#39;

      zsh_completion.install &#39;contrib/completion/git-completion.zsh&#39; =&gt; &#39;_git&#39;
      cp &quot;#{bash_completion}/git-completion.bash&quot;, zsh_completion
    end

    (share+&#39;git-core&#39;).install &#39;contrib&#39;

    # We could build the manpages ourselves, but the build process depends
    # on many other packages, and is somewhat crazy, this way is easier.
    man.install resource(&#39;man&#39;)
    (share+&#39;doc/git-doc&#39;).install resource(&#39;html&#39;)

    # Make html docs world-readable; check if this is still needed at 1.8.6
    chmod 0644, Dir[&quot;#{share}/doc/git-doc/**/*.{html,txt}&quot;]
  end

  def caveats; &lt;&lt;-EOS.undent
    The OS X keychain credential helper has been installed to:
      #{HOMEBREW_PREFIX}/bin/git-credential-osxkeychain

    The &#39;contrib&#39; directory has been installed to:
      #{HOMEBREW_PREFIX}/share/git-core/contrib
    EOS
  end

  test do
    HOMEBREW_REPOSITORY.cd do
      assert_equal &#39;bin/brew&#39;, `#{bin}/git ls-files -- bin`.strip
    end
  end
end
</code></pre></noscript></div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What Is Bare Metal ARM]]></title>
    <link href="http://sushihangover.github.io/what-is-bare-metal-arm"/>
    <updated>2014-02-16T08:12:02-08:00</updated>
    <id>http://sushihangover.github.io/what-is-bare-metal-arm</id>
    <content type="html"><![CDATA[<h2>What is Bare Metal ARM Development?</h2>

<blockquote><p>Bare-Metal ARM Development, also called <a href="http://en.wikipedia.org/wiki/Bare_machine">Bare-Machine</a> is the development of &lsquo;embedded&rsquo; applications, that run without an operating system or other supporting programs, maybe a bootloader, on an ARM processor. The application sits on top of the bare metal, runs ARM instructions (including THUMB), directly controls the processor (MCU) to manage power consumption, GPIOs, ADC, DAC, etc&hellip;</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FleaFPGA Experimenters Board]]></title>
    <link href="http://sushihangover.github.io/fleafpga-experimenters-board"/>
    <updated>2014-02-15T07:14:40-08:00</updated>
    <id>http://sushihangover.github.io/fleafpga-experimenters-board</id>
    <content type="html"><![CDATA[<p><a href="http://sushihangover.github.io/images/Flea_2v4_white2.jpg"><img class="left" src="http://sushihangover.github.io/images/Flea_2v4_white2.jpg" width="360" height="240" title="OSHW FPGA Flea Dev Board" alt="FPGA Flea"></a></p>

<blockquote><p>FleaFPGA provides a low-cost development platfrom for users to explore the wonders of programmable logic and hardware-oriented languages i.e. VHDL and Verilog. FleaFPGA is suited for professional and hobbyist uses.</p><footer><strong>&#8220;Valentin Angelovski&#8221;</strong> <cite><a href='http://www.fleasystems.com/fleaFPGA.html'>www.fleasystems.com/&hellip;</a></cite></footer></blockquote>


<p>Valentin is looking at producing at limited run of his <a href="http://www.latticesemi.com/Products/FPGAandCPLD.aspx">Lattice</a> MachXO2-based <a href="http://www.fleasystems.com/fleaFPGA.html">FleaFPGA boards</a> that are designed to get beginners up, running and experimentings with FPGA programming quickly. For ~100.00 sounds like a great deal. Head over to his site and <a href="http://www.fleasystems.com/forums/showthread.php?tid=29&amp;pid=127#pid127">pre-order</a> one.</p>

<p><img src="http://sushihangover.github.io/images/oshw.jpg" alt="image" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Embedded 'Bare-Metal' ARM Development - Part 1]]></title>
    <link href="http://sushihangover.github.io/embedded-bare-metal-arm-development-part-1"/>
    <updated>2014-02-14T06:01:48-08:00</updated>
    <id>http://sushihangover.github.io/embedded-bare-metal-arm-development-part-1</id>
    <content type="html"><![CDATA[<p>This is a start of a series of posts related to getting into ARM-based Cortex core programming. So I started on a quest to checkout ARM Embedded &lsquo;Bare-Metal&rsquo; compilers and tools and in the end(?) cleared up my confusion about what I can and can not do on a restricted budget and time.</p>

<p>The reasoning behind this is I wanted to do some bare metal ARM C coding for a project that might become some type of OSHW or even a commerical offering so I wanted to keep my options open, try to future proof my decisions.</p>

<p>Instead of falling back to my comfort zone with AVR 8-bit MCU C-codings and forcing a project that really is beyond what AVRs offer (mainly execution speed and size related plus I tired of all the bit-banging to &lsquo;add&rsquo; protocals) and the fact that ARM-based core offerings that are now available have not just tons of digital GPIOs, footprints that are as small, but also have great signal processing options (input and output) that can match or exceed what is available in Amtel&rsquo;s AVR 8-bit line up and<strong> match them at price.</strong></p>

<p>Just compare the Atmel AVR line up to their D20 ARM-core offerings and for non-legacy new embedded projects the decision matrix might be almost equal, but if you are adding &lsquo;future-proofing&rsquo; to the mix and what MCUs will be offering in the next decade, ARM-based MCUs become a clear choice (would love to hear someone&rsquo;s counter-point!).</p>

<p>So first I figured I look at ARM compilers/linkers as if you can not compile/link your code, than you are just screwed ;&ndash;) So in terms of ARM compilers available there <strong>is</strong> more than one:</p>

<ul>
<li><a href="https://launchpad.net/gcc-arm-embedded">GNU C Compiler</a>(1)</li>
<li><a href="http://www.freescale.com/codewarrior">CodeWarrior</a> ARM C Compiler(2)</li>
<li><a href="http://www.iar.com">IAR</a> ARM C Compiler</li>
<li><a href="https://www.imagecraft.com">ImageCraft</a> C Compiler Tools</li>
<li><a href="http://www.keil.com">Kiel</a> ARM C/C++ Compiler(3)</li>
<li><a href="http://ds.arm.com">ARM DS-5</a> RealView C/C++ Compiler(3)</li>
<li>ARM <a href="http://clang.llvm.org">Clang</a>/<a href="http://llvm.org">LLVM</a> Compiler</li>
<li>Microsoft Visual Studio C/C++ Native ARM Compiler(4)</li>
</ul>


<h6>* 1: Technically the launchpad link is the &lsquo;output&rsquo; of an ARM version of GCC and binutils but is the best starting point for info on the ARM version as it is the offical distro end-point ;&ndash;)</h6>

<blockquote><p>ARM employees are maintaining this project. Contributing to this project should be via GCC trunk http://gcc.gnu.org and binutils trunk http://www.gnu.org/software/binutils/. This launchpad project is for communication and downloading. No code change is done in lp project.</p></blockquote>


<h6>* 2: The &lsquo;Freescale Kinetis Compiler&rsquo; is in maintance mode. The GNU compiler is the &lsquo;active&rsquo; mainline of ARM compiler within CodeWarror now and thus I am not looking at this one at all as it fails my future proofing rules. For existing &lsquo;legacy&rsquo; embedded projects based on it, <a href="http://en.wikipedia.org/wiki/CodeWarrior">MetroWorks</a> was acquired by Motorola which was then included in the Freescale spinoff, so go to Freescale if you need a version&hellip;</h6>

<h6>* 3: ARM acquired Kiel and thus the compiler IP from the two is now within one toolchain simply called &ldquo;ARM Compiler toolchain&rdquo; and thus RealView no longer exists, but some old-timers ;&ndash;) still call the new version by the RealView name. Note: There are still different development IDEs from each company; Kiel has uVision and ARM has Eclipse intergation (via a standalone version or plugins for your existing install), but again, they use just the &lsquo;new&rsquo; version of the compiler, but more on the IDEs in a future post of this series.</h6>

<h6>* 4: Yes, you can produce ARM code as you would have to in order to cross-compile Windows RT apps, but can you do bare metal programming with it? I am not sure if you can get a CMSIS setup using it and handle the .S/SystemInit/Reset_Handler/__main() of bare metal programming&hellip;</h6>

<h6>* If I missed one, please let me know!.</h6>

<p>So an ARM compiler choice is not as easy as just saying GNU/GCC as you have other options and while in the end they all produce an ELF/BIN that you flash on your bare-metal ARM, how that binary gets created and the size and speed of the ARM code and/or THUMB instructions that was produced can vary greatly&hellip;</p>

<p>Next time, we look into some compilers&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress: Backing Up Your Source Directory]]></title>
    <link href="http://sushihangover.github.io/octopress-backing-up-your-source-directory"/>
    <updated>2014-02-12T21:00:12-08:00</updated>
    <id>http://sushihangover.github.io/octopress-backing-up-your-source-directory</id>
    <content type="html"><![CDATA[<p>It has only been a couple of days using <a href="http://octopress.org">Octopress</a> and <a href="http://pow.cx">Pow*</a> but I am already sold. For offline blogging, <a href="http://pages.github.com">GitHub Pages</a> support, a great set of standard Markdown-ish driven Plugins, etc&hellip; the workflow is great. There are a few things that I am missing like:</p>

<p>My Missing Octopress Items:</p>

<blockquote><ul>
<li>Image Auto Thumbnailing</li>
<li>Image Popups from those Thumbnails</li>
<li>Post Staging (The &lsquo;published: false&rsquo; yaml front matter is a start but&hellip;.)</li>
<li>Auto source directory version control</li>
</ul>
</blockquote>

<p>That last one was my highest proirity. When you run the Octopress GitHub Pages setup, it configures the deployment repo (XXXXXX.github.io), but you still need to backup and/or version control the &lsquo;source&rsquo; directory.</p>

<p>Here is my quick way of doing this using the deployment repo.</p>

<blockquote><ul>
<li>Add a <strong>source</strong> branch your your &ldquo;XXXXXX.github.io&rdquo; repo</li>
<li>Set your local source directory as a <strong>single branch</strong> of that repo</li>
<li>Commit and Push after you do a <em>rake deploy</em></li>
</ul>
</blockquote>

<p>So lets add a source branch to your GitHub Page repo:</p>

<pre><code>    Note: This is my quick way (ie. hackie) to get an ***EMPTY* new *remote* branch** into an existing repo. If someone knows a better way, I'd love to hear it.
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Get your current repo and place it into a a temp directory</span>
</span><span class='line'>git clone https://github.com/sushihangover/sushihangover.github.io.git foo.bar
</span><span class='line'><span class="nb">pushd </span>foo.bar
</span><span class='line'><span class="c"># Add a new branch to your local copy</span>
</span><span class='line'>git checkout -b <span class="nb">source</span>
</span><span class='line'><span class="c"># Delete all the existing context</span>
</span><span class='line'>rm -Rf *
</span><span class='line'><span class="c"># Commit all those deletes</span>
</span><span class='line'>git commit --all --message<span class="o">=</span><span class="s2">&quot;Initial Empty source branch&quot;</span>
</span><span class='line'><span class="c"># Push that emopty branch back to GitHub</span>
</span><span class='line'>git push
</span><span class='line'><span class="nb">popd</span>
</span><span class='line'><span class="c"># GEt rid of that temp. directory</span>
</span><span class='line'>rm -Rf foo.bar
</span></code></pre></td></tr></table></div></figure>


<p>You already have an existing source directory and if you did not change the _config.yaml defaults is under your Octopress directory and those files need to be placed in this new source branch you just created.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Move your existing source directory out of the way for now</span>
</span><span class='line'>mv <span class="nb">source </span>source.org
</span><span class='line'><span class="c"># Clone your GitHub Page repo BUT only a single branch of it, only the source branch and into a directory named source</span>
</span><span class='line'><span class="c"># Note: The &quot;--single-branch -branch source&quot; options are not used by most git users but can make speciallized repo copies quick and fool-proof</span>
</span><span class='line'>git clone --single-branch -branch <span class="nb">source </span>https://github.com/sushihangover/sushihangover.github.io.git <span class="nb">source</span>
</span><span class='line'><span class="c"># Now copy your existing source files into this empty repo directory</span>
</span><span class='line'>cp -R source.org <span class="nb">source</span>
</span><span class='line'><span class="nb">pushd source</span>
</span><span class='line'><span class="c"># Commit and Push your sources files to GitHub</span>
</span><span class='line'>git commit --all --message<span class="o">=</span><span class="s2">&quot;Initial source branch commit&quot;</span>
</span><span class='line'><span class="c"># Add your commit comment and save</span>
</span><span class='line'>git push
</span></code></pre></td></tr></table></div></figure>


<p>Now you have two branches in your Pages repo. <strong>master</strong> will be your deployed/published blog pages and <strong>source</strong> will be the content Octopress uses to create those pages.</p>

<p>Now, anytime you need to <strong>backup work-in-progress</strong> source changes or after you you do a <strong>rake deploy</strong> you can just do this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">pushd source</span>; git commit --all --message<span class="o">=</span><span class="s2">&quot;Blog updated&quot;</span>; git push; <span class="nb">popd</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ll be including this in the Github Page deploy plugin in the future so everytime I publish (deploy) I will also get a matching commit to the source branch&hellip;. But that and the other items on the Todo list will have to wait till later&hellip; ;&ndash;)</p>

<ul>
<li>Pow is a zero-config Rack server for Mac OS X : <a href="http://get.pow.cx/media/screencast.mov">Watch Me</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GtkSharp-Explorer Update for Irony]]></title>
    <link href="http://sushihangover.github.io/gtksharp-explorer-update-for-irony"/>
    <updated>2014-02-12T08:14:14-08:00</updated>
    <id>http://sushihangover.github.io/gtksharp-explorer-update-for-irony</id>
    <content type="html"><![CDATA[<p><a href="images/Irony-GtkSharp-Explorer-OS-X-ScreenCap.png"><img class="left" src="images/Irony-GtkSharp-Explorer-OS-X-ScreenCap.png" width="360" height="240" title="Irony.GtkSharp.Explorer" alt="Irony GtkSharp Explorer"></a> I was working on a <a href="https://irony.codeplex.com">Irony/C#</a> based DSL that I wrote awhile back and noticed that I had some strange NameSpace issues with the GTK UI (exposed only within Xamarin&rsquo;s Stetic Designer, not sure how those naming conflicts were not a compile time error&hellip;).</p>

<p>Updated source for my Gtk# addition to Irony is on GitHub now. <strong>Remember that my additions are on the &ldquo;gtksharp-explorer&rdquo; branch.</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git branch --all
</span><span class='line'>* master
</span><span class='line'>  remotes/origin/HEAD -&gt; origin/master
</span><span class='line'>  remotes/origin/gtksharp-explorer
</span><span class='line'>  remotes/origin/master
</span><span class='line'>  remotes/origin/xplat-nunit-fix
</span><span class='line'>git checkout gtksharp-explorer
</span><span class='line'>  Branch gtksharp-explorer <span class="nb">set </span>up to track remote branch gtksharp-explorer from origin.
</span><span class='line'>  Switched to a new branch <span class="s1">&#39;gtksharp-explorer&#39;</span>
</span><span class='line'>
</span><span class='line'>git branch --all
</span><span class='line'>* gtksharp-explorer
</span><span class='line'>  master
</span><span class='line'>  remotes/origin/HEAD -&gt; origin/master
</span><span class='line'>  remotes/origin/gtksharp-explorer
</span><span class='line'>  remotes/origin/master
</span><span class='line'>  remotes/origin/xplat-nunit-fix
</span><span class='line'>open Irony_All.MonoDevelop.sln
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>==============================</p>

<h1>Grammar Explorer based on Gtk#</h1>

<p><em>For cross-platform Irony work in Mono 3.2.X and MonoDevelop/Xamarin 4.1.X/4.2.X</em>
Instructions for building on Mono:</p>

<h2>Via MonoDevelop/Xamarin IDE:</h2>

<ul>
<li>Release or Debug Targets:
      Load and build via the Irony_All.MonoDevelop.sln
Via cmd line:</li>
</ul>


<hr />

<ul>
<li><p>Release:
xbuild /p:Configuration=Release Irony_All.MonoDevelop.sln
mono Irony.GrammarExplorer.GtkSharp/bin/Release/Irony.GrammarExplorer.GtkSharp.exe</p></li>
<li><p>Debug:
xbuild /p:Configuration=Release Irony_All.MonoDevelop.sln
mono Irony.GrammarExplorer.GtkSharp/bin/Debug/Irony.GrammarExplorer.GtkSharp.exe</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ellcc.org Build Fix for OS-X]]></title>
    <link href="http://sushihangover.github.io/ellcc-dot-org-build-fix-for-os-x"/>
    <updated>2014-02-12T00:00:00-08:00</updated>
    <id>http://sushihangover.github.io/ellcc-dot-org-build-fix-for-os-x</id>
    <content type="html"><![CDATA[<p>In my ARM Bare Metal searches for using Clang/LLVM I stumbled across <a href="http://ellcc.org">The ELLCC Embedded Compiler Collection</a> that provides a one-stop build enviroment for all the LLVM tools for cross-platform compiling.</p>

<p>I&rsquo;m not sure if they are trying to be a <a href="http://yagarto.org">YAGARTO</a> for LLVM vs. GCC. I waiting for a reply to post on their forum to understand the actual code changes to Clang/LLVM that they include (if any). <del>I will update when I hear back.</del> <strong>(Update: Read Rich&rsquo;s <a href="http://ellcc.org/blog/?topic=ellcc-vs-clangllvm-trunk/#post-1571">full reply</a>, it cleared everything up for me)</strong></p>

<blockquote><p>ELLCC is really just a weekly repackaging of clang/LLVM with two minor additions.<br/>1. The triples of the form -ellcc- (where OS is linux for now, but will include others eventually) control how include files and libraries are found. You might notice for example that the #include path for ELLCC&#8230;</p><footer><strong>Rich</strong> <cite><a href='http://ellcc.org/blog/?topic=ellcc-vs-clangllvm-trunk/#post-1571'>What Is ELLCC All About</a></cite></footer></blockquote>


<p>But in the mean time I figured I give it a build and include it in my GCC/ARM vs. Clang/LLVM-ARM testing but hit a build error on OS-X. On the linking of QEMU, libintl (GNU&rsquo;s gettext) is not found:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>LINK  i386-softmmu/qemu-system-i386
</span><span class='line'>ld: library not found for -lintl
</span><span class='line'>clang: error: linker command failed with exit code 1 (use -v to see invocation)
</span><span class='line'>make[1]: *** [qemu-system-i386] Error 1
</span><span class='line'>make: *** [subdir-i386-softmmu] Error 2</span></code></pre></td></tr></table></div></figure>


<p>I do have gettext on my system, but it is in my &ldquo;Cellar&rdquo;&ldquo; as I use <a href="http://brew.sh">HomeBrew</a> as my package manager and try not to install anything to &rdquo;/usr/bin&#8221; or other systems places that can muck everything up and thus can run parrallels versions of different applications (i.e. If I have to &lsquo;sudo&rsquo; to an open-source software install, it is not going on my system unless they have a serious reason for it and I trust the code from a security viewpoint).</p>

<p>FYI: Brew does not &lsquo;hard&rsquo; link gettext as compiling software outside of the HomeBrew can cause problems:</p>

<blockquote><p>brew link gettext<br/>Warning: gettext is keg-only and must be linked with &#8211;force<br/>Note that doing so can interfere with building software.</p></blockquote>


<p>So I mod&rsquo;d the &ldquo;ellcc/gnu/build&rdquo; to force brew to link gettext before compiling/linking qemu and unlink it after.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>svn diff build
</span><span class='line'>Index: <span class="nv">build</span>
</span><span class='line'><span class="o">===================================================================</span>
</span><span class='line'>--- build <span class="o">(</span>revision 3780<span class="o">)</span>
</span><span class='line'>+++ build <span class="o">(</span>working copy<span class="o">)</span>
</span><span class='line'>@@ -69,6 +69,10 @@
</span><span class='line'>     ppc-linux-user ppc64-linux-user ppc64abi32-linux-user sparc-linux-user<span class="s2">&quot;</span>
</span><span class='line'><span class="s2"> fi</span>
</span><span class='line'><span class="s2"> echo Configuring package qemu for $targets</span>
</span><span class='line'><span class="s2">+if [!  -e `which brew` ]; then</span>
</span><span class='line'><span class="s2">+    ruby -e &quot;</span><span class="k">$(</span>curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install<span class="k">)</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">+fi</span>
</span><span class='line'><span class="s2">+brew link gettext --force</span>
</span><span class='line'><span class="s2"> qemu_target_list=`echo $qemu_target_list | sed -e &quot;</span>s/ /,/g<span class="err">&quot;</span><span class="sb">`</span>
</span><span class='line'> make <span class="nv">DIR</span><span class="o">=</span>src/qemu <span class="nv">CC</span><span class="o">=</span><span class="nv">$cc</span> <span class="nv">HCC</span><span class="o">=</span><span class="nv">$hcc</span> <span class="nv">AR</span><span class="o">=</span><span class="nv">$ar</span> <span class="nv">TARGET</span><span class="o">=</span><span class="nv">$host</span> <span class="nv">OS</span><span class="o">=</span><span class="nv">$os</span> <span class="se">\</span>
</span><span class='line'>     <span class="nv">targetlist</span><span class="o">=</span><span class="nv">$qemu_target_list</span> <span class="nv">haslibs</span><span class="o">=</span><span class="nv">$haslibs</span> <span class="se">\</span>
</span><span class='line'>@@ -76,6 +80,7 @@
</span><span class='line'>     qemu.configure <span class="o">||</span> <span class="nb">exit </span>1
</span><span class='line'>
</span><span class='line'> make -C src/qemu <span class="o">||</span> <span class="nb">exit </span>1
</span><span class='line'>+brew unlink gettext
</span><span class='line'>
</span><span class='line'> <span class="c"># Finally, install into the target specific bin dir.</span>
</span><span class='line'> mkdir -p <span class="nv">$bindir</span>
</span></code></pre></td></tr></table></div></figure>


<p>Everything builds fine after that&hellip;</p>

<p>The entire file is here:</p>

<div><script src='https://gist.github.com/8949755.js'></script>
<noscript><pre><code>#!/bin/sh
# ELLCC GNU tools build script.

# Get the staging directory.
prefix=`cd ..; pwd`

# Figure out the compilers to use.
. ../build-setup $*

echo Configured to $WHY.
echo C compiler: $cc $CFLAGS
echo C++ compiler: $cxx $CXXFLAGS
echo In: gnu-build$builddir

# Configure for GNU tools.
mkdir -p gnu-build$builddir

# Configure for binutils.
# binutils are build to support all targets in the target list.
echo Configuring package binutils for $targets
make DIR=gnu-build$builddir CC=$cc CXX=$cxx AR=$ar TARGET=$host OS=$os \
    targetlist=$targetlist haslibs=$haslibs \
    bindir=$bindir prefix=$prefix build=$build \
    binutils.configure || exit 1

make -C gnu-build$builddir/binutils || exit 1

# Configure for assemblers for all targets.
for t in $targets; do
  echo Configuring the assembler for $t
  make DIR=gnu-build$builddir CC=$cc CXX=$cxx AR=$ar TARGET=$host OS=$os \
      target=$t haslibs=$haslibs \
      bindir=$bindir prefix=$prefix build=$build \
      gas.configure || exit 1

  make -C gnu-build$builddir/binutils/$t || exit 1
done

# Configure for GDB.
# GDB is built to support all GDB targets.
echo Configuring package gdb for $targets
make DIR=gnu-build$builddir CC=$cc CXX=$cxx AR=$ar TARGET=$host OS=$os \
    targetlist=$targetlist haslibs=$haslibs \
    bindir=$bindir prefix=$prefix build=$build \
    gdb.configure || exit 1

make -C gnu-build$builddir/gdb || exit 1

if [ &quot;$host&quot; != &quot;$build&quot; ] ; then
  # The host system is not the build system.
  # Build only  binutils, the assemblers, and gdb.
  # Finally, install into the target specific bin dir.
  mkdir -p $bindir
  make TARGETDIR=$builddir BINDIR=$bindir installcross || exit 1
  exit 0
fi

# Configure for QEMU.
# The QEMU system targets.
qemu_target_list=&quot;i386-softmmu x86_64-softmmu arm-softmmu \
    microblaze-softmmu mips-softmmu mipsel-softmmu \
    ppc-softmmu ppc64-softmmu sparc-softmmu&quot;

if [ `uname` = &quot;Linux&quot; ] ; then
    # The QEMU Linux user space targets.
    qemu_target_list=&quot;$qemu_target_list i386-linux-user \
    x86_64-linux-user arm-linux-user armeb-linux-user \
    microblaze-linux-user mips-linux-user mipsel-linux-user \
    ppc-linux-user ppc64-linux-user ppc64abi32-linux-user sparc-linux-user&quot;
fi
echo Configuring package qemu for $targets
if [!  -e `which brew` ]; then
        ruby -e &quot;$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)&quot;
fi
brew link gettext --force
qemu_target_list=`echo $qemu_target_list | sed -e &quot;s/ /,/g&quot;`
make DIR=src/qemu CC=$cc HCC=$hcc AR=$ar TARGET=$host OS=$os \
    targetlist=$qemu_target_list haslibs=$haslibs \
    bindir=$bindir prefix=$prefix build=$build \
    qemu.configure || exit 1

make -C src/qemu || exit 1
brew unlink gettext

# Finally, install into the target specific bin dir.
mkdir -p $bindir
make TARGETDIR=$builddir BINDIR=$bindir install || exit 1
</code></pre></noscript></div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OS-X LLVM / CLANG Build]]></title>
    <link href="http://sushihangover.github.io/os-x-llvm-slash-clang-build"/>
    <updated>2014-02-11T00:00:00-08:00</updated>
    <id>http://sushihangover.github.io/os-x-llvm-slash-clang-build</id>
    <content type="html"><![CDATA[<p>I wanted to test out some C code that I am writting for a ARM Bare Metal (Embedded) project in QEMU (qemu-system-arm) and normally would just use the <a href="https://launchpad.net/gcc-arm-embedded">GNU Tools for ARM Embedded Processors</a> but I was wondering what the current state of LLVM is for cross-compiling to bare-metal ARM.</p>

<p>Since this is a new area for me and I am having a <strong>dang hard time</strong> finding what is and isn&rsquo;t supported in CLang/LLVM for embedded ARM development, I figured I would compile the latest version and see the difference in code that gets produced between the gcc and Clang compilers.</p>

<p>Thus I needed to latest and greatest Clang/LLVM and did not feel like nurse-maiding a huge git download and long compile session, so I spent a minute and hacked up a really simple script so I could catch up on &ldquo;Game of Thrones&rdquo; ;&ndash;)</p>

<div><script src='https://gist.github.com/8946898.js'></script>
<noscript><pre><code>git clone http://llvm.org/git/llvm.git
pushd llvm/tools
git clone http://llvm.org/git/clang.git
popd
pushd llvm/projects
git clone http://llvm.org/git/compiler-rt.git
popd
pushd llvm/projects
git clone http://llvm.org/git/test-suite.git
popd
mkdir llvmbuild
pushd llvmbuild
../llvm/configure --enable-optimized --enable-jit --prefix=/Users/administrator/llvm-install 
make
</code></pre></noscript></div>


<p>FYI: <a href="http://clang.llvm.org/docs/CrossCompilation.html">Cross-compilation using Clang</a></p>
]]></content>
  </entry>
  
</feed>
